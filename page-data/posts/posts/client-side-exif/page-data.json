{"componentChunkName":"component---src-templates-post-template-js","path":"/posts//posts/client-side-exif/","result":{"data":{"markdownRemark":{"id":"29650ccd-d740-57cd-a4e1-b652564d3ab5","html":"<div class=\"gatsby-highlight\" data-language=\"coffeescript\"><pre class=\"language-coffeescript\"><code class=\"language-coffeescript\">  <span class=\"token number\">1</span>        <span class=\"token number\">2</span>       <span class=\"token number\">3</span>      <span class=\"token number\">4</span>         <span class=\"token number\">5</span>            <span class=\"token number\">6</span>           <span class=\"token number\">7</span>          <span class=\"token number\">8</span>\n\n<span class=\"token multiline-comment comment\">######  ###</span><span class=\"token multiline-comment comment\">###      ##  ##      ###</span><span class=\"token multiline-comment comment\">#######</span>  <span class=\"token comment\">##                  ##  </span><span class=\"token multiline-comment comment\">#######</span><span class=\"token multiline-comment comment\">###\n##          ##      ##  ##      ##  ##      ##  ##          ##  ##      ##  ##\n###</span><span class=\"token comment\">#      </span><span class=\"token multiline-comment comment\">####    ###</span><span class=\"token comment\">#  </span><span class=\"token multiline-comment comment\">####    ##          ###</span><span class=\"token multiline-comment comment\">#######</span>  <span class=\"token multiline-comment comment\">#######</span><span class=\"token multiline-comment comment\">###          ##\n##          ##      ##  ##\n##          ##  ###</span><span class=\"token multiline-comment comment\">###  ###</span><span class=\"token comment\">###</span></code></pre></div>\n<h3 id=\"onstart\" style=\"position:relative;\"><a href=\"#onstart\" aria-label=\"onstart permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>onStart</h3>\n<p>Images with exif data are often not that easy to handle. Manipulating images on the client and passing around metadata can be a slow and painful process. I have used many of the options available to one when trying to get exif in JavaScript. This is a review of several viable options for getting exif from an image.</p>\n<p>For testing purposes throughout this review I recommend using images with exif data intact. Dave Perret has a pack of them <a href=\"https://github.com/recurser/exif-orientation-examples\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">over on github</a> that you can download.</p>\n<h3 id=\"image-orientation-in-firefox\" style=\"position:relative;\"><a href=\"#image-orientation-in-firefox\" aria-label=\"image orientation in firefox permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Image Orientation in Firefox</h3>\n<p>Althought this doesn’t deal with extracting EXIF, it is worth mentioning for those looking for a solution to orientation problems. The only browser which actually allows for image orientation correction right now is <a href=\"https://developer.mozilla.org/en-US/docs/Web/CSS/image-orientation#Browser_compatibility\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Firefox 26 beta or above</a>. Adding this feature is very simple. Just apply the image-orientation style using css to any image tag. <a href=\"https://code.google.com/p/chromium/issues/detail?id=158753\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Unfortunately chrome has yet to implement this feature</a> and the only way to see correctly oriented images is by having an image at the <a href=\"https://code.google.com/p/chromium/issues/detail?id=56845#c66\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">top level of the DOM</a>. As time passes this feature will become adopted, and possibly images will be rotated automatically.</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>img</span> <span class=\"token style-attr\"><span class=\"token attr-name\">style</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token style language-css\"><span class=\"token property\">image-orientation</span><span class=\"token punctuation\">:</span> from-image</span><span class=\"token punctuation\">\"</span></span></span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>image.jpg<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span></code></pre></div>\n<p>See for yourself how this works in <a href=\"http://jsfiddle.net/L3S7R/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">my example</a>. Firefox will return the best results, but you should be able to try it in any browser you have installed. Documentation for the image-orientation style can be <a href=\"http://dev.w3.org/csswg/css3-images/#image-orientation\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">found on w3</a>.</p>\n<h3 id=\"load-image-library\" style=\"position:relative;\"><a href=\"#load-image-library\" aria-label=\"load image library permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Load-Image Library</h3>\n<p>This library is great at, you guessed it, loading images! It has the idea of mix and matching behind its implementation. You can grab the exif and the main library and start parsing data with very few lines of code. After parsing the exif data out, you have to load the image again. This isn’t great for performance but it does work very well. Try it out for yourself <a href=\"https://github.com/blueimp/JavaScript-Load-Image\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">here</a>.</p>\n<div class=\"gatsby-highlight\" data-language=\"coffeescript\"><pre class=\"language-coffeescript\"><code class=\"language-coffeescript\"><span class=\"token comment\"># Parsing the Metadata</span>\nloadImage<span class=\"token punctuation\">.</span>parseMetaData file<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span>\n  options <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">if</span> data<span class=\"token punctuation\">.</span>exif\n    options<span class=\"token punctuation\">.</span>orientation <span class=\"token operator\">=</span> data<span class=\"token punctuation\">.</span>exif<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Orientation'</span><span class=\"token punctuation\">)</span>\n    options<span class=\"token punctuation\">.</span>canvas <span class=\"token operator\">=</span> <span class=\"token keyword\">true</span> <span class=\"token comment\"># tells loadImage we want a canvas returned</span>\n  <span class=\"token comment\"># Load the Image with new options</span>\n  loadImage file<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span>\n    <span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">'some_div'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">,</span> options\n\n<span class=\"token comment\"># You could also scale an image</span>\ncanvas <span class=\"token operator\">=</span> loadImage<span class=\"token punctuation\">.</span>scale image<span class=\"token punctuation\">,</span>\n  <span class=\"token property\">left</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span>\n  <span class=\"token property\">top</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span>\n  <span class=\"token property\">sourceWidth</span><span class=\"token operator\">:</span> image<span class=\"token punctuation\">.</span>width\n  <span class=\"token property\">sourceHeight</span><span class=\"token operator\">:</span> image<span class=\"token punctuation\">.</span>height\n  <span class=\"token property\">maxWidth</span><span class=\"token operator\">:</span> target_width\n  <span class=\"token property\">maxHeight</span><span class=\"token operator\">:</span> target_height</code></pre></div>\n<p>As you can see the Load-Image lib allows for a lot more than just exif extraction. You can manipulate images in many ways using this tool. The downsides are that this doesn’t use a web worker, so you cannot count on this when doing other performance heavy operations. If you would like to test this out for yourself, they have <a href=\"http://blueimp.github.io/JavaScript-Load-Image/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">a great demo</a>.</p>\n<h3 id=\"exif-and-binaryajax\" style=\"position:relative;\"><a href=\"#exif-and-binaryajax\" aria-label=\"exif and binaryajax permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>EXIF and BinaryAJAX</h3>\n<p>Although old, these two files will allow you to extract EXIF meta data from JPEG images. This is best used with the FileReader API available on most modern browsers.\n<a href=\"http://www.nihilogic.dk/labs/exif/exif.js\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">EXIF</a> and <a href=\"http://www.nihilogic.dk/labs/binaryajax/binaryajax.js\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">BinaryAJAX</a> are available at <a href=\"http://nihilogic.dk\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">http://nihilogic.dk</a> . Below is an example of using the FileReader to load the image, and then extract the exif with EXIF and BinaryAJAX.</p>\n<div class=\"gatsby-highlight\" data-language=\"coffeescript\"><pre class=\"language-coffeescript\"><code class=\"language-coffeescript\">image <span class=\"token operator\">=</span> <span class=\"token class-member variable\">@files</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token comment\"># Get the first file from the user</span>\nreader <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FileReader</span>\nreader<span class=\"token punctuation\">.</span>onloadend <span class=\"token operator\">=</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span>\n  exif <span class=\"token operator\">=</span> <span class=\"token constant\">EXIF</span><span class=\"token punctuation\">.</span>readFromBinaryFile <span class=\"token keyword\">new</span> <span class=\"token class-name\">BinaryFile</span> <span class=\"token class-member variable\">@result</span>\nreader<span class=\"token punctuation\">.</span>readAsBinaryString image</code></pre></div>\n<p>The advantage of this library is that it doesn’t require much, and you do not have to load the image many times. All it really requires is the use of the File API. The downside is you don’t get the advantages of manipulating the images, or resizing properly. All you get is the EXIF data. Seeing as this one is outdated, I would just <a href=\"http://sandbox.juurlink.org/html5imageuploader/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">give it a try</a> or try the more <a href=\"http://jsfiddle.net/interstateone/gtLWG/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">code friendly example</a>. Visit the github page <a href=\"https://github.com/jseidelin/exif-js\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">here</a> for more information.</p>\n<h3 id=\"flickrs-exif-extraction\" style=\"position:relative;\"><a href=\"#flickrs-exif-extraction\" aria-label=\"flickrs exif extraction permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Flickr’s EXIF Extraction</h3>\n<p><a href=\"http://code.flickr.net/2012/06/01/parsing-exif-client-side-using-javascript-2/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Flickr has a great write up</a> in regards to extracting the metadata using web workers. Web workers appear to be a very performant option. Similarly to the example above, you need to use the FileReader API, but more efficiently slice off only the part of the image that contains the exif data. When working with the exif data in a web worker, the EXIF tag for orientation will be at offset 0x112.</p>\n<div class=\"gatsby-highlight\" data-language=\"coffeescript\"><pre class=\"language-coffeescript\"><code class=\"language-coffeescript\"><span class=\"token comment\"># Slice up the section of the file that contains the exif (128 KiloBytes = 131072 Bytes)</span>\n<span class=\"token keyword\">if</span> file<span class=\"token punctuation\">.</span>slice\n  filePart <span class=\"token operator\">=</span> file<span class=\"token punctuation\">.</span>slice <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">131072</span>\n<span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> file<span class=\"token punctuation\">.</span>webkitSlice\n  filePart <span class=\"token operator\">=</span> file<span class=\"token punctuation\">.</span>webkitSlice <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">131072</span>\n<span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> file<span class=\"token punctuation\">.</span>mozSlice\n  filePart <span class=\"token operator\">=</span> file<span class=\"token punctuation\">.</span>mozSlice <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">131072</span>\n<span class=\"token keyword\">else</span>\n  filePart <span class=\"token operator\">=</span> file\n\n<span class=\"token comment\"># Read part of the file, then send it to our worker for processing</span>\nreader <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FileReader</span>\nreader<span class=\"token punctuation\">.</span>onload <span class=\"token operator\">=</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span>\n  <span class=\"token comment\"># Refers to a worker you must define</span>\n  jobBlob <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Blob</span> <span class=\"token punctuation\">[</span>workers<span class=\"token punctuation\">.</span>exif_processor<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span><span class=\"token property\">type</span><span class=\"token operator\">:</span> <span class=\"token string\">\"text/javascript\"</span><span class=\"token punctuation\">}</span>\n  worker <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Worker</span> <span class=\"token constant\">URL</span><span class=\"token punctuation\">.</span>createObjectURL jobBlob\n  worker<span class=\"token punctuation\">.</span>addEventListener <span class=\"token string\">'message'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span>\n    console<span class=\"token punctuation\">.</span>log <span class=\"token string\">\"Exif Orientation Data:\"</span><span class=\"token punctuation\">,</span> e<span class=\"token punctuation\">.</span>data\n  worker<span class=\"token punctuation\">.</span>postMessage\n    <span class=\"token property\">binary</span><span class=\"token operator\">:</span> <span class=\"token class-member variable\">@result</span>\nreader<span class=\"token punctuation\">.</span>readAsBinaryString filePart</code></pre></div>\n<p>Using Web Workers to process the exif data is the fastest way to correcting your images. You may even be able to get web workers working with one of the examples above. Flickr used to acquire most of the metadata server side, but now they moved over to doing it on the client. Hopefully this will convince others to do the same, and we can get the webs images looking better than they have in the past.</p>\n<h3 id=\"onfinish\" style=\"position:relative;\"><a href=\"#onfinish\" aria-label=\"onfinish permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>onFinish</h3>\n<p>Consistent exif orientation handling is wack on the web, <a href=\"http://www.daveperrett.com/articles/2012/07/28/exif-orientation-handling-is-a-ghetto/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">a great article on this topic</a>, goes into detail about the current state of orientation handling. If you think you know a better way, or an alternative to the methods I went over here, please let me know. Extracting EXIF is hard enough, having to manipulate images after is overkill.</p>","fields":{"slug":"/posts//posts/client-side-exif/","tagSlugs":["/tag/exif/","/tag/web-worker/","/tag/java-script/"]},"frontmatter":{"date":"2014-04-14T09:59:53.000Z","description":null,"tags":["EXIF","Web Worker","JavaScript"],"title":"Client-Side EXIF","socialImage":null}}},"pageContext":{"slug":"/posts//posts/client-side-exif/"}},"staticQueryHashes":["251939775","2857265606","401334301"]}