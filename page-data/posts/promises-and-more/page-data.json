{"componentChunkName":"component---src-templates-post-template-js","path":"/posts/promises-and-more","result":{"data":{"markdownRemark":{"id":"d574af5c-3740-5697-a71a-6508f32a76f3","html":"<h3 id=\"onstart\" style=\"position:relative;\"><a href=\"#onstart\" aria-label=\"onstart permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>onStart</h3>\n<p>I’ve recently begun using promises in my javascript and even now I understand how useful they can be. I have come across many tools in the last year that I have found to be helpful. Certain situations have just appeared very hard, and then suddenly the perfect tool would allow me to continue on and overcome a hurdle. Promises are a tool such as that.</p>\n<h3 id=\"jquery-deferreds\" style=\"position:relative;\"><a href=\"#jquery-deferreds\" aria-label=\"jquery deferreds permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>jQuery Deferreds</h3>\n<p>Although jQuery Deferred promises aren’t A+ Compliant, I still find them to be very useful. Often when writing Backbone.Marionette apps I have needed to make a major change to a view and immediately after do some work. This happens in almost ever view in every app I have worked on. Say you need to navigate to another part of the app but first require closing the view the user is looking at. Calling the close or remove method on your view will often do the trick, but when you have extra work, timing becomes important. In many examples, I see people calling the event, and then executing the close. This does work, but is only working because of timing. If you use a jquery deferred you can execute the event after the closing of the view.</p>\n<div class=\"gatsby-highlight\" data-language=\"coffeescript\"><pre class=\"language-coffeescript\"><code class=\"language-coffeescript\">$deferred <span class=\"token operator\">=</span> $<span class=\"token punctuation\">.</span><span class=\"token function\">Deferred</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n$deferred<span class=\"token punctuation\">.</span>resolve @<span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n$deferred<span class=\"token punctuation\">.</span>done <span class=\"token operator\">-</span><span class=\"token operator\">></span> App<span class=\"token punctuation\">.</span>vent<span class=\"token punctuation\">.</span>trigger <span class=\"token string\">'show:dialog'</span></code></pre></div>\n<h3 id=\"image-loading-with-jquery-promises\" style=\"position:relative;\"><a href=\"#image-loading-with-jquery-promises\" aria-label=\"image loading with jquery promises permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Image Loading with jQuery Promises</h3>\n<p>Many libraries exist to load images, but I like to rock my own. Using jQuery Deferred promises you can go a step further with image loading. Javascript offers an image object which has a few callbacks on it. onLoad, onError, and onAbort can be used with jQuery promises so that you can be sure that the image has succeeded or failed at loading properly.</p>\n<div class=\"gatsby-highlight\" data-language=\"coffeescript\"><pre class=\"language-coffeescript\"><code class=\"language-coffeescript\">imageLoader <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span>\n  loadImage <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>deferred<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span>\n\n    loaded <span class=\"token operator\">=</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span>\n      <span class=\"token function\">unbindEvents</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n      deferred<span class=\"token punctuation\">.</span>resolve image\n\n    errored <span class=\"token operator\">=</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span>\n      <span class=\"token function\">unbindEvents</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n      deferred<span class=\"token punctuation\">.</span>reject image\n\n    unbindEvents <span class=\"token operator\">=</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span>\n      image<span class=\"token punctuation\">.</span>onload <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span>\n      image<span class=\"token punctuation\">.</span>onerror <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span>\n      image<span class=\"token punctuation\">.</span>onabort <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span>\n\n    image <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Image</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    image<span class=\"token punctuation\">.</span>onload <span class=\"token operator\">=</span> loaded\n    image<span class=\"token punctuation\">.</span>onerror <span class=\"token operator\">=</span> errored\n    image<span class=\"token punctuation\">.</span>onabort <span class=\"token operator\">=</span> errored\n\n    image<span class=\"token punctuation\">.</span>src <span class=\"token operator\">=</span> url\n\n  <span class=\"token comment\"># promise causes the resolve/reject methods to not be accessible.</span>\n  $<span class=\"token punctuation\">.</span><span class=\"token function\">Deferred</span><span class=\"token punctuation\">(</span>loadImage<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>With the above imageLoader you could do something like the example below.</p>\n<div class=\"gatsby-highlight\" data-language=\"coffeescript\"><pre class=\"language-coffeescript\"><code class=\"language-coffeescript\">$promise <span class=\"token operator\">=</span> imageLoader <span class=\"token string\">'http://catgif.com/cat.gif'</span>\n$promise<span class=\"token punctuation\">.</span><span class=\"token function\">done</span> <span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.loading'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>replaceWith image\n$promise<span class=\"token punctuation\">.</span>fail <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.loading'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>replaceWith <span class=\"token string\">'&lt;img src=\"sadface.png\">&lt;/img>'</span></code></pre></div>\n<h3 id=\"a-promises\" style=\"position:relative;\"><a href=\"#a-promises\" aria-label=\"a promises permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>A+ Promises</h3>\n<p>A promise is an eventual result of an asynchronous operation. Many people have argued over exactly what the terminology should be and how the inner workings should work. If you aren’t looking to argue about this, and just want to take advantage of promises. I recommend starting with q. <a href=\"http://documentup.com/kriskowal/q/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Q is an A+ compliant library</a>, and it works using the expected when then format.</p>\n<div class=\"gatsby-highlight\" data-language=\"coffeescript\"><pre class=\"language-coffeescript\"><code class=\"language-coffeescript\"><span class=\"token comment\"># Normal Q Promise structure</span>\n<span class=\"token constant\">Q</span><span class=\"token punctuation\">.</span>fcall step1\n<span class=\"token punctuation\">.</span><span class=\"token keyword\">then</span> step2\n<span class=\"token punctuation\">.</span><span class=\"token keyword\">then</span> step3\n<span class=\"token punctuation\">.</span><span class=\"token keyword\">then</span> <span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> console<span class=\"token punctuation\">.</span>log value\n<span class=\"token punctuation\">.</span><span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> console<span class=\"token punctuation\">.</span>log error\n<span class=\"token punctuation\">.</span><span class=\"token function\">done</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># Any function that returns a promise</span>\npromise <span class=\"token operator\">=</span> @<span class=\"token function\">climber</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\npromise<span class=\"token punctuation\">.</span><span class=\"token keyword\">when</span> @<span class=\"token function\">climbAMountain</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\"># A when is a static then</span>\npromise<span class=\"token punctuation\">.</span><span class=\"token keyword\">then</span> @<span class=\"token function\">fallDown</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">.</span><span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span>\n  <span class=\"token comment\"># A note on Q promises:</span>\n  <span class=\"token comment\"># It will catch any errors while you are climbing or falling</span>\n<span class=\"token punctuation\">.</span><span class=\"token function\">done</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># Q also offers a try catch finally block</span>\npromise <span class=\"token operator\">=</span> @<span class=\"token function\">anotherPromise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\npromise<span class=\"token punctuation\">.</span><span class=\"token keyword\">then</span> <span class=\"token comment\"># try some work</span>\npromise<span class=\"token punctuation\">.</span><span class=\"token keyword\">catch</span> <span class=\"token comment\"># catch some error</span>\npromise<span class=\"token punctuation\">.</span>fin <span class=\"token comment\"># finally do thing</span></code></pre></div>\n<p>Q is a very flexible promise library. It allows you to chain promises and execute arrays of promises. It is easy to use, and combined with coffeescript becomes one of the most readable solutions.</p>\n<h3 id=\"tools\" style=\"position:relative;\"><a href=\"#tools\" aria-label=\"tools permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Tools</h3>\n<p>Promises are great and have helped dig me out of a lot of holes. Having helpers to assist you along the way when building a web app makes development more enjoyable and relaxing. I’ll share some of the other tools that I use to help me along the way. Many people might be thinking why build my own when I can just download something like UnderscoreJS. Libraries are great, but occassionally you come up with a great piece that you just carry with you. I recommend building your own set and improving upon them. Share them with the developers you work with and just spread the word.</p>\n<div class=\"gatsby-highlight\" data-language=\"coffeescript\"><pre class=\"language-coffeescript\"><code class=\"language-coffeescript\"><span class=\"token comment\"># Cleanup video and audio elements when you are done with them.</span>\n<span class=\"token property\">cleanupMedia</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>$media<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span>\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">unless</span> $media<span class=\"token punctuation\">.</span>length\n  $media<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">pause</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  $media<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>src <span class=\"token operator\">=</span> <span class=\"token string\">''</span>\n  $media<span class=\"token punctuation\">.</span><span class=\"token function\">children</span><span class=\"token punctuation\">(</span><span class=\"token string\">'source'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>prop <span class=\"token string\">'src'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">''</span>\n  $media<span class=\"token punctuation\">.</span><span class=\"token function\">remove</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>length <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n\n<span class=\"token comment\"># Methods to check for HTML5 Video and Audio Support</span>\n<span class=\"token property\">supports_video</span><span class=\"token operator\">:</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token operator\">!</span><span class=\"token operator\">!</span>document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'video'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>canPlayType\n<span class=\"token property\">supports_audio</span><span class=\"token operator\">:</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token operator\">!</span><span class=\"token operator\">!</span>document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'audio'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>canPlayType\n\n<span class=\"token comment\"># Move the cursor to the end of an input</span>\n$<span class=\"token punctuation\">.</span>fn<span class=\"token punctuation\">.</span>focusToEnd <span class=\"token operator\">=</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> @<span class=\"token keyword\">each</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span>\n  v <span class=\"token operator\">=</span> <span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">val</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">focus</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">val</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>val v\n<span class=\"token comment\"># Then do this:</span>\n<span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.input'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">focusToEnd</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># A contains method for the String class</span>\n<span class=\"token keyword\">if</span> <span class=\"token keyword\">not</span> String<span class=\"token operator\">:</span><span class=\"token operator\">:</span>contains <span class=\"token keyword\">then</span> String<span class=\"token operator\">:</span><span class=\"token operator\">:</span>contains <span class=\"token operator\">=</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> String<span class=\"token operator\">:</span><span class=\"token operator\">:</span><span class=\"token function\">indexOf</span><span class=\"token punctuation\">.</span><span class=\"token function\">apply</span><span class=\"token punctuation\">(</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> arguments <span class=\"token punctuation\">)</span> <span class=\"token keyword\">isnt</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span>\n<span class=\"token comment\"># Use it like so:</span>\n<span class=\"token string\">\"apple\"</span><span class=\"token punctuation\">.</span>contains <span class=\"token string\">'app'</span> <span class=\"token comment\"># returns true</span></code></pre></div>\n<h3 id=\"onfinish\" style=\"position:relative;\"><a href=\"#onfinish\" aria-label=\"onfinish permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>onFinish</h3>\n<p>A promise is not the swiss army knife of javascript tools. However it will get you out of hard and ugly situations with asynchronous code. <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"normal\">.</mi><mi>a</mi><mi>j</mi><mi>a</mi><mi>x</mi><mo separator=\"true\">,</mo></mrow><annotation encoding=\"application/x-tex\">.ajax,</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.85396em;vertical-align:-0.19444em;\"></span><span class=\"mord\">.</span><span class=\"mord mathnormal\">a</span><span class=\"mord mathnormal\" style=\"margin-right:0.05724em;\">j</span><span class=\"mord mathnormal\">a</span><span class=\"mord mathnormal\">x</span><span class=\"mpunct\">,</span></span></span></span>.post, and $.get all return deferreds that you can then listen in on. That is where the .done, .fail, .always methods come from in asnychronous jquery. Promises are a great way to finish the job, and at any time. Promise libraries exist other than Q, and I would recommend reading about the various other ones before deciding on Q. May promises help you in your developments. If you have any questions feel free to ask, I will respond, I promise.</p>","fields":{"slug":"/posts/promises-and-more","tagSlugs":["/tag/promises/","/tag/java-script/"]},"frontmatter":{"date":"2014-05-05T12:30:53.000Z","description":null,"tags":["Promises","JavaScript"],"title":"Promises and More","socialImage":null}}},"pageContext":{"slug":"/posts/promises-and-more"}},"staticQueryHashes":["251939775","2857265606","401334301"]}