{"componentChunkName":"component---src-templates-post-template-js","path":"/posts/boxview","result":{"data":{"markdownRemark":{"id":"5de7b9b8-d433-5f5c-b09f-b69215fcf31e","html":"<h3 id=\"onstart\" style=\"position:relative;\"><a href=\"#onstart\" aria-label=\"onstart permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>onStart</h3>\n<p>The <a href=\"https://developers.box.com/view/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">BoxViewAPI</a> is useful for displaying documents in the browser without needing to do any heavy lifting. You can quickly turn any PDF, MS Document, or MS PowerPoint into HTML and display it inline on your website. The HTML is hosted by Box, and you can easily display this on your site by using an iFrame. Alternatively you could download the HTML and display it with viewer.js. Make sure you <a href=\"https://app.box.com/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">signup</a> and <a href=\"https://app.box.com/developers/services\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">create a BoxView app</a> before you start. The app will have an API key that you will need in all requests you make with Box. I am implementing it in Rails, but you could do this on any backend in exactly the same fashion.</p>\n<h3 id=\"upload-a-document\" style=\"position:relative;\"><a href=\"#upload-a-document\" aria-label=\"upload a document permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Upload a Document</h3>\n<p>The first step to making a viewable document is uploading the file to box. I decided to use the net::http library when communicating with the BoxViewAPI. However, you can use any RESTful lib. RestClient is another popular one. Then make a post with the necessary headers. The response if successful will contain a document id.</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\">  <span class=\"token comment\"># Headers used throughout these examples</span>\n  <span class=\"token comment\"># Get YOUR_API_KEY from the box view application page</span>\n  <span class=\"token constant\">BOX_HEADERS</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string\">'Authorization'</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token string\">\"Token <span class=\"token interpolation\"><span class=\"token delimiter tag\">#{</span><span class=\"token constant\">YOUR_API_KEY</span><span class=\"token delimiter tag\">}</span></span>\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'Content-type'</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token string\">'application/json'</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">def</span> <span class=\"token method-definition\"><span class=\"token function\">upload_document</span></span>\n    document_uri <span class=\"token operator\">=</span> <span class=\"token constant\">URI</span><span class=\"token punctuation\">.</span>parse<span class=\"token punctuation\">(</span><span class=\"token string\">\"https://view-api.box.com/1/documents\"</span><span class=\"token punctuation\">)</span>\n    data <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token string\">'url'</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> original_url\n      <span class=\"token comment\"># If thumbnails are desired:</span>\n      <span class=\"token comment\">#, 'thumbnails' => '100x100'</span>\n    <span class=\"token punctuation\">}</span>\n    http <span class=\"token operator\">=</span> <span class=\"token constant\">Net</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">HTTP</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">new</span><span class=\"token punctuation\">(</span>document_uri<span class=\"token punctuation\">.</span>host<span class=\"token punctuation\">,</span> document_uri<span class=\"token punctuation\">.</span>port<span class=\"token punctuation\">)</span>\n    http<span class=\"token punctuation\">.</span>use_ssl <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span>\n    request <span class=\"token operator\">=</span> <span class=\"token constant\">Net</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">HTTP</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">Post</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">new</span><span class=\"token punctuation\">(</span>document_uri<span class=\"token punctuation\">.</span>path<span class=\"token punctuation\">,</span> <span class=\"token constant\">BOX_HEADERS</span><span class=\"token punctuation\">)</span>\n    request<span class=\"token punctuation\">.</span>body <span class=\"token operator\">=</span> data<span class=\"token punctuation\">.</span>to_json\n    response <span class=\"token operator\">=</span> http<span class=\"token punctuation\">.</span>request<span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">)</span>\n    parsed <span class=\"token operator\">=</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span>parse response<span class=\"token punctuation\">.</span>body\n    document_id <span class=\"token operator\">=</span> parsed<span class=\"token punctuation\">[</span><span class=\"token string\">\"id\"</span><span class=\"token punctuation\">]</span>\n    <span class=\"token keyword\">return</span> document_id\n    <span class=\"token comment\"># or self.update_attribute :document_id, document_id</span>\n  <span class=\"token keyword\">end</span></code></pre></div>\n<h3 id=\"create-a-session\" style=\"position:relative;\"><a href=\"#create-a-session\" aria-label=\"create a session permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Create a Session</h3>\n<p>Now that you have a document id, you can make upload_document return the id or just save it to a model (This is useful if you’re interested in implementing WebHooks). Next you can use that document id to create a session which will begin the conversion of the document, and let you know when it is ready. If you are using this in your web app frequently, I recommend using <a href=\"http://sidekiq.org/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Sidekiq</a> to offload all these network calls and possible database saves to an asynchronous process. When successful, box will return a 201, which means the document is ready for viewing. If you don’t get a 201 you will get a 202 or 400 response code. A 202 means the document is not yet ready for viewing. A 400 means the conversion has failed. If you’d like to view your file at this point, just head over to <a href=\"https://view-api.box.com/1/sessions/%7Bsession%20id%7D/view?theme=light\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://view-api.box.com/1/sessions/{session id}/view?theme=light</a>, where session id is the id you get from the 201 response.</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\">  <span class=\"token keyword\">def</span> <span class=\"token method-definition\"><span class=\"token function\">create_session</span></span><span class=\"token punctuation\">(</span>document_id<span class=\"token punctuation\">)</span>\n    session_uri <span class=\"token operator\">=</span> <span class=\"token constant\">URI</span><span class=\"token punctuation\">.</span>parse<span class=\"token punctuation\">(</span><span class=\"token string\">\"https://view-api.box.com/1/sessions\"</span><span class=\"token punctuation\">)</span>\n    data <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token string\">\"document_id\"</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> document_id\n      <span class=\"token comment\">#, \"expires_at\" => Time.now + 1.hour</span>\n      <span class=\"token comment\"># You could specify an expiration date.</span>\n    <span class=\"token punctuation\">}</span>\n    http <span class=\"token operator\">=</span> <span class=\"token constant\">Net</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">HTTP</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">new</span><span class=\"token punctuation\">(</span>session_uri<span class=\"token punctuation\">.</span>host<span class=\"token punctuation\">,</span> session_uri<span class=\"token punctuation\">.</span>port<span class=\"token punctuation\">)</span>\n    http<span class=\"token punctuation\">.</span>use_ssl <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span>\n    request <span class=\"token operator\">=</span> <span class=\"token constant\">Net</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">HTTP</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">Post</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">new</span><span class=\"token punctuation\">(</span>session_uri<span class=\"token punctuation\">.</span>path<span class=\"token punctuation\">,</span> <span class=\"token constant\">BOX_HEADERS</span><span class=\"token punctuation\">)</span>\n    request<span class=\"token punctuation\">.</span>body <span class=\"token operator\">=</span> data<span class=\"token punctuation\">.</span>to_json\n    response <span class=\"token operator\">=</span> http<span class=\"token punctuation\">.</span>request<span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">case</span> response<span class=\"token punctuation\">.</span>code\n    <span class=\"token keyword\">when</span> <span class=\"token string\">\"201\"</span> <span class=\"token comment\"># Done converting</span>\n      parsed <span class=\"token operator\">=</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span>parse response<span class=\"token punctuation\">.</span>body\n      session_id <span class=\"token operator\">=</span> parsed<span class=\"token punctuation\">[</span><span class=\"token string\">\"id\"</span><span class=\"token punctuation\">]</span>\n      <span class=\"token keyword\">return</span> session_id\n      <span class=\"token comment\"># or self.update_attribute :session_id, session_id</span>\n    <span class=\"token keyword\">when</span> <span class=\"token string\">\"202\"</span> <span class=\"token comment\"># Session not ready yet</span>\n      time <span class=\"token operator\">=</span> response<span class=\"token punctuation\">[</span><span class=\"token string\">'Retry-After'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>to_i\n      <span class=\"token comment\"># here you would retry based on the time variable</span>\n      <span class=\"token comment\"># You could use sidekiqs perform_in method, or just sleep</span>\n    <span class=\"token keyword\">when</span> <span class=\"token string\">\"400\"</span> <span class=\"token comment\"># An error occurred while converting the document or the document does not exist</span>\n      <span class=\"token constant\">Rails</span><span class=\"token punctuation\">.</span>logger<span class=\"token punctuation\">.</span>debug <span class=\"token string\">\"Document failed to convert - <span class=\"token interpolation\"><span class=\"token delimiter tag\">#{</span>response<span class=\"token punctuation\">.</span>body<span class=\"token delimiter tag\">}</span></span>\"</span>\n    <span class=\"token keyword\">else</span>\n      <span class=\"token keyword\">raise</span> <span class=\"token string\">\"BoxSessionError <span class=\"token interpolation\"><span class=\"token delimiter tag\">#{</span>response<span class=\"token punctuation\">.</span>inspect<span class=\"token delimiter tag\">}</span></span>\"</span>\n    <span class=\"token keyword\">end</span>\n  <span class=\"token keyword\">end</span></code></pre></div>\n<h3 id=\"generate-a-thumbnail\" style=\"position:relative;\"><a href=\"#generate-a-thumbnail\" aria-label=\"generate a thumbnail permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Generate a Thumbnail</h3>\n<p>A cool feature BoxView has is thumbnail generation. It can return a thumbnail of any size 16-1024 wide by 16-768 high. This way you can see a preview of the document before displaying it to a user. The BoxView API only requires a height and width, and the document that you want the thumbnail generated from.</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\">  <span class=\"token keyword\">def</span> <span class=\"token method-definition\"><span class=\"token function\">generate_thumbnail</span></span><span class=\"token punctuation\">(</span>document_id<span class=\"token punctuation\">)</span>\n    query_params <span class=\"token operator\">=</span> <span class=\"token string\">\"?width=100&amp;height=100\"</span>\n    thumbnail_uri <span class=\"token operator\">=</span> <span class=\"token constant\">URI</span><span class=\"token punctuation\">.</span>parse<span class=\"token punctuation\">(</span><span class=\"token string\">\"https://view-api.box.com/1/documents/<span class=\"token interpolation\"><span class=\"token delimiter tag\">#{</span>document_id<span class=\"token delimiter tag\">}</span></span>/thumbnail\"</span><span class=\"token punctuation\">)</span>\n    http <span class=\"token operator\">=</span> <span class=\"token constant\">Net</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">HTTP</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">new</span><span class=\"token punctuation\">(</span>thumbnail_uri<span class=\"token punctuation\">.</span>host<span class=\"token punctuation\">,</span> thumbnail_uri<span class=\"token punctuation\">.</span>port<span class=\"token punctuation\">)</span>\n    http<span class=\"token punctuation\">.</span>use_ssl <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span>\n    thumbnail_path <span class=\"token operator\">=</span> thumbnail_uri<span class=\"token punctuation\">.</span>path <span class=\"token operator\">+</span> params\n    request <span class=\"token operator\">=</span> <span class=\"token constant\">Net</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">HTTP</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">Get</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">new</span><span class=\"token punctuation\">(</span>thumbnail_path<span class=\"token punctuation\">,</span> <span class=\"token constant\">BOX_HEADERS</span><span class=\"token punctuation\">)</span>\n    response <span class=\"token operator\">=</span> http<span class=\"token punctuation\">.</span>request<span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">case</span> response<span class=\"token punctuation\">.</span>code\n    <span class=\"token keyword\">when</span> <span class=\"token string\">\"200\"</span> <span class=\"token comment\"># Valid thumbnail</span>\n      thumbnail <span class=\"token operator\">=</span> response<span class=\"token punctuation\">.</span>body\n      <span class=\"token comment\"># Now upload the thumbnail to another server</span>\n      <span class=\"token comment\"># or use it however you would like</span>\n    <span class=\"token keyword\">when</span> <span class=\"token string\">\"202\"</span> <span class=\"token comment\"># Thumbnail isn't ready yet</span>\n      time <span class=\"token operator\">=</span> response<span class=\"token punctuation\">[</span><span class=\"token string\">'Retry-After'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>to_i\n      <span class=\"token comment\"># Same as a session 202, sleep or worker</span>\n    <span class=\"token keyword\">when</span> <span class=\"token string\">\"400\"</span> <span class=\"token comment\"># Width/Height are invalid</span>\n      <span class=\"token constant\">Rails</span><span class=\"token punctuation\">.</span>logger<span class=\"token punctuation\">.</span>debug <span class=\"token string\">\"400 Box Thumbnail Width x Height Invalid - <span class=\"token interpolation\"><span class=\"token delimiter tag\">#{</span>response<span class=\"token punctuation\">.</span>body<span class=\"token delimiter tag\">}</span></span>\"</span>\n    <span class=\"token keyword\">else</span>\n      <span class=\"token keyword\">raise</span> <span class=\"token string\">\"BoxThumbnailError <span class=\"token interpolation\"><span class=\"token delimiter tag\">#{</span>response<span class=\"token punctuation\">.</span>inspect<span class=\"token delimiter tag\">}</span></span>\"</span>\n    <span class=\"token keyword\">end</span>\n  <span class=\"token keyword\">end</span></code></pre></div>\n<p>Box offers a chance of producing the thumbnail earlier in the process. If you state the width and height earlier when uploading the document, box will have the thumbnail ready by the time you call generate_thumbnail. After getting the thumbnail from the response you could upload it to your own server.</p>\n<h3 id=\"onfinish\" style=\"position:relative;\"><a href=\"#onfinish\" aria-label=\"onfinish permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>onFinish</h3>\n<p>My examples above are all in ruby, but their also exists a <a href=\"https://view-upload.herokuapp.com/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">great python project on GitHub</a> that shows how to do the same. If you needed help getting started with BoxView I hope you no longer do. If you require WebHooks with BoxView, they aren’t very difficult. Just email api@box.com with your API key and domain to send the responses to a controller. If you want to test that WebHooks work in your testing environment, I recommend using <a href=\"https://ngrok.com\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">ngrok</a>. It helped me confirm everything was in a good working condition before using it in other environments. As always, if you need help let me know.</p>","fields":{"slug":"/posts/boxview","tagSlugs":["/tag/box/","/tag/ruby/","/tag/rails/"]},"frontmatter":{"date":"2014-05-18T21:51:11.000Z","description":null,"tags":["Box","Ruby","Rails"],"title":"BoxView","socialImage":null}}},"pageContext":{"slug":"/posts/boxview"}},"staticQueryHashes":["251939775","2857265606","401334301"]}