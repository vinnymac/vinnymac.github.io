{"componentChunkName":"component---src-templates-post-template-js","path":"/posts/html5-video-and-audio/","webpackCompilationHash":"c25ac13ed87f966527db","result":{"data":{"markdownRemark":{"id":"0c7105af-fed2-54d0-ba34-b00d43735bda","html":"<h3 id=\"onstart\"><a href=\"#onstart\" aria-label=\"onstart permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>onStart</h3>\n<p>HTML5 makes placing an audio or video stream into your web app simple. However, not all browsers can use HTML5 (IE > 8, Chrome > 3, FF > 3). Many great solutions such as <a href=\"https://github.com/videojs/video.js\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">VideoJS</a> and <a href=\"http://kolber.github.io/audiojs/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">AudioJS</a> try to alleviate that issue. In this article I will be going over how one might implement HTML5 video and audio in a dynamic and reusable fashion. The various features available when templating, and the tribulations when working with video and audio in javascript.</p>\n<h3 id=\"video-and-audio-templates\"><a href=\"#video-and-audio-templates\" aria-label=\"video and audio templates permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Video and Audio Templates</h3>\n<p>To begin let’s see what HTML5 video and audio tags might look like in a template.</p>\n<div class=\"gatsby-highlight\" data-language=\"haml\"><pre class=\"language-haml\"><code class=\"language-haml\"># (poster, height, and width are video only features)\n<span class=\"token tag\">%video#movie<span class=\"token attributes\"><span class=\"token punctuation\">{</span>height<span class=\"token punctuation\">:</span> <span class=\"token number\">640</span><span class=\"token punctuation\">,</span> width<span class=\"token punctuation\">:</span> <span class=\"token number\">480</span><span class=\"token punctuation\">,</span> poster<span class=\"token punctuation\">:</span> <span class=\"token string\">\"some.png\"</span><span class=\"token punctuation\">,</span> controls<span class=\"token punctuation\">,</span> autoplay<span class=\"token punctuation\">,</span> loop<span class=\"token punctuation\">}</span></span></span>\n  <span class=\"token tag\">%source#mp4<span class=\"token attributes\"><span class=\"token punctuation\">{</span>src<span class=\"token punctuation\">:</span> <span class=\"token string\">'rickroll.mp4'</span><span class=\"token punctuation\">,</span> type<span class=\"token punctuation\">:</span> <span class=\"token string\">'video/mp4; codecs=\"avc1.42E01E, mp4a.40.2\"'</span><span class=\"token punctuation\">}</span></span></span>\n  <span class=\"token tag\">%source#ogg</span> <span class=\"token punctuation\">-</span><span class=\"token code\"> <span class=\"token comment\"># you can specify as many of these as you like, or just one.</span></span>\n  Your browser does not support the video type or codec.\n\n<span class=\"token tag\">%audio#speakers<span class=\"token attributes\"><span class=\"token punctuation\">{</span>preload<span class=\"token punctuation\">:</span> auto<span class=\"token punctuation\">,</span> controls<span class=\"token punctuation\">:</span> <span class=\"token keyword\">true</span><span class=\"token punctuation\">,</span> autoplay<span class=\"token punctuation\">:</span> <span class=\"token keyword\">true</span><span class=\"token punctuation\">,</span> loop<span class=\"token punctuation\">:</span> <span class=\"token keyword\">true</span><span class=\"token punctuation\">}</span></span></span>\n  <span class=\"token tag\">%source#mp3<span class=\"token attributes\"><span class=\"token punctuation\">{</span>src<span class=\"token punctuation\">:</span> <span class=\"token string\">'getlucky.mp3'</span><span class=\"token punctuation\">}</span></span></span>\n  Something terrible has occurred, run for your lives!</code></pre></div>\n<p>Above a HAML file contains an HTML5 video and audio tag. Let’s go over some of their attributes. Looking at the video tag we can see I specified a height and width just like a div (video only). The controls attribute tells the browser to show the built in controls, it takes a boolean value. Autoplay makes the browser play the media automatically, and it takes a boolean value. Loop causes the media to play indefinitely, and it takes a boolean value. The poster attribute displays an image until the first frame of the video has loaded. An external or local image can be specified (video only). The preload attribute, which can be one of three things, none | metadata | auto. The media can also take a src attribute, but when dynamically controlling html5 video/audio it is easier to place a source tag underneath and specify the source manually or from JS. The source tag also allows for specifying the content type and codec of the video that will be playing. Lastly you can specify in plain text an error message, if the media you are trying to play is not supported. A list of all the <a href=\"https://developer.mozilla.org/en-US/docs/Web/HTML/Element/video\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">video attributes</a> and <a href=\"https://developer.mozilla.org/en-US/docs/Web/HTML/Element/audio\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">audio attributes</a> can be found on MDN.</p>\n<h3 id=\"dynamic-video-and-audio\"><a href=\"#dynamic-video-and-audio\" aria-label=\"dynamic video and audio permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Dynamic Video and Audio</h3>\n<p>Having control over the video and audio that may be playing is a desirable feature. Unfortunately you may want to use something jQuery to help you do this. Currently jQuery does not support HTML5 video and audio. You are going to have to use straight javascript (in my case coffeescript).</p>\n<div class=\"gatsby-highlight\" data-language=\"coffeescript\"><pre class=\"language-coffeescript\"><code class=\"language-coffeescript\"><span class=\"token comment\"># You cannot use jQuery to do this:</span>\n<span class=\"token comment\"># @$('#movie').load()</span>\n<span class=\"token comment\"># However you can get the first DOM element.</span>\nmovie <span class=\"token operator\">=</span> @<span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">'#movie'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token comment\"># If you want to retain jQuery, use eq(0) instead.</span>\n\n<span class=\"token comment\"># Optionally set the source in JS.</span>\n@<span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">'#mp4'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>src <span class=\"token operator\">=</span> <span class=\"token string\">'/rickroll.mp4'</span>\n\n<span class=\"token comment\"># First you will need to load the video.</span>\nmovie<span class=\"token punctuation\">.</span><span class=\"token function\">load</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># Check if the video can be played, before playing it.</span>\nmovie<span class=\"token punctuation\">.</span><span class=\"token function\">canPlayType</span><span class=\"token punctuation\">(</span><span class=\"token string\">'video/mp4'</span><span class=\"token punctuation\">)</span> <span class=\"token comment\"># returns 'maybe', 'probably' or ''</span>\n\n<span class=\"token comment\"># Then you can play it.</span>\nmovie<span class=\"token punctuation\">.</span><span class=\"token function\">play</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># To pause you can call pause or trigger the event</span>\nmovie<span class=\"token punctuation\">.</span><span class=\"token function\">pause</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\"># or @$('#movie').trigger 'pause'</span>\n\n<span class=\"token comment\"># For stopping playback all together, their are a few solutions.</span>\nmovie<span class=\"token punctuation\">.</span><span class=\"token function\">pause</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nmovie<span class=\"token punctuation\">.</span>currentTime <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n<span class=\"token comment\"># or</span>\nmovie<span class=\"token punctuation\">.</span>src <span class=\"token operator\">=</span> <span class=\"token string\">''</span>\n<span class=\"token comment\"># or</span>\n@<span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">'#movie'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">remove</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># Several events exist that you can listen in on.</span>\n<span class=\"token comment\"># How do I know when the first frame has loaded?</span>\nmovie<span class=\"token punctuation\">.</span>addEventListener <span class=\"token string\">'loadeddata'</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> console<span class=\"token punctuation\">.</span>log <span class=\"token string\">'Done loading!'</span>\n<span class=\"token comment\"># How can I calculate the progress of a video?</span>\nmovie<span class=\"token punctuation\">.</span>addEventListener <span class=\"token string\">'progress'</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> console<span class=\"token punctuation\">.</span>log <span class=\"token class-member variable\">@buffered</span><span class=\"token punctuation\">.</span><span class=\"token function\">end</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token class-member variable\">@duration</span>\n<span class=\"token comment\"># How do I know how far along the video is?</span>\nmovie<span class=\"token punctuation\">.</span>addEventListener <span class=\"token string\">'timeupdate'</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> console<span class=\"token punctuation\">.</span>log <span class=\"token class-member variable\">@currentTime</span> <span class=\"token operator\">/</span> <span class=\"token class-member variable\">@duration</span></code></pre></div>\n<p>All of the examples above would also work for audio, just replace the #movie id with the #speakers id. HTML5 is very feature rich. You can get just about any of the information that you could want when using these APIs. I only went over a few of the <a href=\"https://developer.mozilla.org/en-US/docs/Web/Guide/Events/Media_events\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">events that HTML5 offers</a>. I recommend reading over the rest to get a better grasp of the available tools.</p>\n<div class=\"gatsby-highlight\" data-language=\"coffeescript\"><pre class=\"language-coffeescript\"><code class=\"language-coffeescript\"><span class=\"token comment\"># For audio you can use the built in Audio Constructor as well.</span>\nsound <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Audio</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'http://musicdomain.com/getlucky.mp3'</span><span class=\"token punctuation\">]</span>\n<span class=\"token comment\"># Preload gets set to auto by default.</span>\n<span class=\"token comment\"># Sources aren't available as a fallback, so manually detect compatibility.</span>\n<span class=\"token keyword\">unless</span> sound<span class=\"token punctuation\">.</span>canPlayType<span class=\"token operator\">?</span> <span class=\"token string\">'audio/mpeg'</span>\n  <span class=\"token comment\"># An alternative like flash/silverlight goes here.</span></code></pre></div>\n<h3 id=\"backbone-example\"><a href=\"#backbone-example\" aria-label=\"backbone example permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Backbone Example</h3>\n<p>Before wrapping up let’s take a look at a real life example. This would be in the case that you were using Backbone, but any structural web application would work similarly. Below I have built a tiny MP3 player that is being controlled and styled through a backbone view, with custom play and pause button ids.</p>\n<div class=\"gatsby-highlight\" data-language=\"coffeescript\"><pre class=\"language-coffeescript\"><code class=\"language-coffeescript\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">MP3Player</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Backbone<span class=\"token punctuation\">.</span>View</span>\n  <span class=\"token property\">template</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'mp3_player'</span>\n  <span class=\"token property\">events</span><span class=\"token punctuation\">:</span>\n    <span class=\"token string\">'click #play'</span>  <span class=\"token punctuation\">:</span> <span class=\"token string\">'play'</span>\n    <span class=\"token string\">'click #pause'</span> <span class=\"token punctuation\">:</span> <span class=\"token string\">'pause'</span>\n  <span class=\"token property\">initialize</span><span class=\"token punctuation\">:</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> @<span class=\"token function\">loadAudio</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token property\">loadAudio</span><span class=\"token punctuation\">:</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span>\n    @$speakers <span class=\"token operator\">=</span> @<span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">'#speakers'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n    @<span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">'#mp3'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>src <span class=\"token operator\">=</span> <span class=\"token string\">'http://musicdomain.com/getlucky.mp3'</span>\n    @<span class=\"token function\">load</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token property\">load</span><span class=\"token punctuation\">:</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> @$speakers<span class=\"token punctuation\">.</span><span class=\"token function\">load</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token property\">play</span><span class=\"token punctuation\">:</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> @$speakers<span class=\"token punctuation\">.</span><span class=\"token function\">play</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token property\">pause</span><span class=\"token punctuation\">:</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> @$speakers<span class=\"token punctuation\">.</span><span class=\"token function\">pause</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>I found that when using HTML5 video and audio in a structural app, the code is more readable. Through a combination of backbone and coffeescript you can create a clean and concise video or audio player. Wrapping the video or audio tags in a container allows you to customize many aspects. Which allows for things like custom control interfaces. Using the timeupdate event you could display a message to the user as they progress or finish streaming. Things can get tricky at times because of the lack of jQuery support. But keep in mind that if you fall back to basic javascript things will work out just fine.</p>\n<h3 id=\"onfinish\"><a href=\"#onfinish\" aria-label=\"onfinish permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>onFinish</h3>\n<p>Some may argue that the HTML5 Video and Audio APIs aren’t worth introducing yet. Many implementations always have to offer a fallback option using Flash or an alternative like Silverlight. If you take a look at Soundcloud or Youtube, to this day you have to go into some experimental mode just to turn on HTML5 media playback. On top of that browsers differ in their implementation of the HTML5 API and so you have to tiptoe around when using it. This has been the case for most internet related things since the beginning of time, so I doubt this will deter anyone from using it. If you find yourself struggling feel free to contact me. Also the VideoJS and AudioJS libs take care of the majority of failure cases and allow for easy styling out of the box.</p>","fields":{"slug":"/posts/html5-video-and-audio/","tagSlugs":["/tag/coffeescript/","/tag/html-5/","/tag/java-script/"]},"frontmatter":{"date":"2014-04-28T16:27:05.000Z","description":null,"tags":["Coffeescript","HTML5","JavaScript"],"title":"HTML5 Video and Audio"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/posts/html5-video-and-audio/"}}}