
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Promises and More - Dev Continuum</title>
  <meta name="author" content="Vincent Taverna">

  
  <meta name="description" content="onStart I&rsquo;ve recently begun using promises in my javascript and even now I understand how useful they can be. I have come across many tools in &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://vinnymac.github.io/blog/2014/05/05/promises-and-more">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Dev Continuum" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Dev Continuum</a></h1>
  
    <h2>Web and Android Development</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:vinnymac.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Promises and More</h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-05-05T12:30:53-04:00" pubdate data-updated="true">May 5<span>th</span>, 2014</time>
        
      </p>
    
  </header>


<div class="entry-content"><h3>onStart</h3>

<p>I&rsquo;ve recently begun using promises in my javascript and even now I understand how useful they can be. I have come across many tools in the last year that I have found to be helpful. Certain situations have just appeared very hard, and then suddenly the perfect tool would allow me to continue on and overcome a hurdle. Promises are a tool such as that.</p>

<h3>jQuery Deferreds</h3>

<p>Although jQuery Deferred promises aren&rsquo;t A+ Compliant, I still find them to be very useful. Often when writing Backbone.Marionette apps I have needed to make a major change to a view and immediately after do some work. This happens in almost ever view in every app I have worked on. Say you need to navigate to another part of the app but first require closing the view the user is looking at. Calling the close or remove method on your view will often do the trick, but when you have extra work, timing becomes important. In many examples, I see people calling the event, and then executing the close. This does work, but is only working because of timing. If you use a jquery deferred you can execute the event after the closing of the view.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="nv">$deferred = </span><span class="nx">$</span><span class="p">.</span><span class="nx">Deferred</span><span class="p">()</span>
</span><span class='line'><span class="nx">$deferred</span><span class="p">.</span><span class="nx">resolve</span> <span class="nx">@close</span><span class="p">()</span>
</span><span class='line'><span class="nx">$deferred</span><span class="p">.</span><span class="nx">done</span> <span class="nf">-&gt;</span> <span class="nx">App</span><span class="p">.</span><span class="nx">vent</span><span class="p">.</span><span class="nx">trigger</span> <span class="s">&#39;show:dialog&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Image Loading with jQuery Promises</h3>

<p>Many libraries exist to load images, but I like to rock my own. Using jQuery Deferred promises you can go a step further with image loading. Javascript offers an image object which has a few callbacks on it. onLoad, onError, and onAbort can be used with jQuery promises so that you can be sure that the image has succeeded or failed at loading properly.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="nv">imageLoader = </span><span class="nf">(url) -&gt;</span>
</span><span class='line'>  <span class="nv">loadImage = </span><span class="nf">(deferred) -&gt;</span>
</span><span class='line'>
</span><span class='line'>    <span class="nv">loaded = </span><span class="nf">-&gt;</span>
</span><span class='line'>      <span class="nx">unbindEvents</span><span class="p">()</span>
</span><span class='line'>      <span class="nx">deferred</span><span class="p">.</span><span class="nx">resolve</span> <span class="nx">image</span>
</span><span class='line'>
</span><span class='line'>    <span class="nv">errored = </span><span class="nf">-&gt;</span>
</span><span class='line'>      <span class="nx">unbindEvents</span><span class="p">()</span>
</span><span class='line'>      <span class="nx">deferred</span><span class="p">.</span><span class="nx">reject</span> <span class="nx">image</span>
</span><span class='line'>
</span><span class='line'>    <span class="nv">unbindEvents = </span><span class="nf">-&gt;</span>
</span><span class='line'>      <span class="nv">image.onload = </span><span class="kc">null</span>
</span><span class='line'>      <span class="nv">image.onerror = </span><span class="kc">null</span>
</span><span class='line'>      <span class="nv">image.onabort = </span><span class="kc">null</span>
</span><span class='line'>
</span><span class='line'>    <span class="nv">image = </span><span class="k">new</span> <span class="nx">Image</span><span class="p">()</span>
</span><span class='line'>    <span class="nv">image.onload = </span><span class="nx">loaded</span>
</span><span class='line'>    <span class="nv">image.onerror = </span><span class="nx">errored</span>
</span><span class='line'>    <span class="nv">image.onabort = </span><span class="nx">errored</span>
</span><span class='line'>
</span><span class='line'>    <span class="nv">image.src = </span><span class="nx">url</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># promise causes the resolve/reject methods to not be accessible.</span>
</span><span class='line'>  <span class="nx">$</span><span class="p">.</span><span class="nx">Deferred</span><span class="p">(</span><span class="nx">loadImage</span><span class="p">).</span><span class="nx">promise</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<p>With the above imageLoader you could do something like the example below.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="nv">$promise = </span><span class="nx">imageLoader</span> <span class="s">&#39;http://catgif.com/cat.gif&#39;</span>
</span><span class='line'><span class="nx">$promise</span><span class="p">.</span><span class="nx">done</span> <span class="nf">(image) -&gt;</span> <span class="nx">$</span><span class="p">(</span><span class="s">&#39;.loading&#39;</span><span class="p">).</span><span class="nx">replaceWith</span> <span class="nx">image</span>
</span><span class='line'><span class="nx">$promise</span><span class="p">.</span><span class="nx">fail</span> <span class="nf">-&gt;</span> <span class="nx">$</span><span class="p">(</span><span class="s">&#39;.loading&#39;</span><span class="p">).</span><span class="nx">replaceWith</span> <span class="s">&#39;&lt;img src=&quot;sadface.png&quot;&gt;&lt;/img&gt;&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<h3>A+ Promises</h3>

<p>A promise is an eventual result of an asynchronous operation. Many people have argued over exactly what the terminology should be and how the inner workings should work. If you aren&rsquo;t looking to argue about this, and just want to take advantage of promises. I recommend starting with q. <a href="http://documentup.com/kriskowal/q/">Q is an A+ compliant library</a>, and it works using the expected when then format.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="c1"># Normal Q Promise structure</span>
</span><span class='line'><span class="nx">Q</span><span class="p">.</span><span class="nx">fcall</span> <span class="nx">step1</span>
</span><span class='line'><span class="p">.</span><span class="nx">then</span> <span class="nx">step2</span>
</span><span class='line'><span class="p">.</span><span class="nx">then</span> <span class="nx">step3</span>
</span><span class='line'><span class="p">.</span><span class="nx">then</span> <span class="nf">(value) -&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="nx">value</span>
</span><span class='line'><span class="p">.</span><span class="nx">catch</span> <span class="nf">(error) -&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="nx">error</span>
</span><span class='line'><span class="p">.</span><span class="nx">done</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Any function that returns a promise</span>
</span><span class='line'><span class="nv">promise = </span><span class="nx">@climber</span><span class="p">()</span>
</span><span class='line'><span class="nx">promise</span><span class="p">.</span><span class="nx">when</span> <span class="nx">@climbAMountain</span><span class="p">()</span> <span class="c1"># A when is a static then</span>
</span><span class='line'><span class="nx">promise</span><span class="p">.</span><span class="nx">then</span> <span class="nx">@fallDown</span><span class="p">()</span>
</span><span class='line'><span class="p">.</span><span class="nx">catch</span> <span class="nf">(error) -&gt;</span>
</span><span class='line'>  <span class="c1"># A note on Q promises:</span>
</span><span class='line'>  <span class="c1"># It will catch any errors while you are climbing or falling</span>
</span><span class='line'><span class="p">.</span><span class="nx">done</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Q also offers a try catch finally block</span>
</span><span class='line'><span class="nv">promise = </span><span class="nx">@anotherPromise</span><span class="p">()</span>
</span><span class='line'><span class="nx">promise</span><span class="p">.</span><span class="nx">then</span> <span class="c1"># try some work</span>
</span><span class='line'><span class="nx">promise</span><span class="p">.</span><span class="nx">catch</span> <span class="c1"># catch some error</span>
</span><span class='line'><span class="nx">promise</span><span class="p">.</span><span class="nx">fin</span> <span class="c1"># finally do thing</span>
</span></code></pre></td></tr></table></div></figure>


<p>Q is a very flexible promise library. It allows you to chain promises and execute arrays of promises. It is easy to use, and combined with coffeescript becomes one of the most readable solutions.</p>

<h3>Tools</h3>

<p>Promises are great and have helped dig me out of a lot of holes. Having helpers to assist you along the way when building a web app makes development more enjoyable and relaxing. I&rsquo;ll share some of the other tools that I use to help me along the way. Many people might be thinking why build my own when I can just download something like UnderscoreJS. Libraries are great, but occassionally you come up with a great piece that you just carry with you. I recommend building your own set and improving upon them. Share them with the developers you work with and just spread the word.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="c1"># Cleanup video and audio elements when you are done with them.</span>
</span><span class='line'><span class="nv">cleanupMedia: </span><span class="nf">($media) -&gt;</span>
</span><span class='line'>  <span class="k">return</span> <span class="k">unless</span> <span class="nx">$media</span><span class="p">.</span><span class="nx">length</span>
</span><span class='line'>  <span class="nx">$media</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">pause</span><span class="p">()</span>
</span><span class='line'>  <span class="nx">$media</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nv">src = </span><span class="s">&#39;&#39;</span>
</span><span class='line'>  <span class="nx">$media</span><span class="p">.</span><span class="nx">children</span><span class="p">(</span><span class="s">&#39;source&#39;</span><span class="p">).</span><span class="nx">prop</span> <span class="s">&#39;src&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span>
</span><span class='line'>  <span class="nx">$media</span><span class="p">.</span><span class="nx">remove</span><span class="p">().</span><span class="nv">length = </span><span class="mi">0</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Methods to check for HTML5 Video and Audio Support</span>
</span><span class='line'><span class="nv">supports_video: </span><span class="nf">-&gt;</span> <span class="o">!!</span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s">&#39;video&#39;</span><span class="p">).</span><span class="nx">canPlayType</span>
</span><span class='line'><span class="nv">supports_audio: </span><span class="nf">-&gt;</span> <span class="o">!!</span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s">&#39;audio&#39;</span><span class="p">).</span><span class="nx">canPlayType</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Move the cursor to the end of an input</span>
</span><span class='line'><span class="nv">$.fn.focusToEnd = </span><span class="nf">-&gt;</span> <span class="nx">@each</span> <span class="nf">-&gt;</span>
</span><span class='line'>  <span class="nv">v = </span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span>
</span><span class='line'>  <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">focus</span><span class="p">().</span><span class="nx">val</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">).</span><span class="nx">val</span> <span class="nx">v</span>
</span><span class='line'><span class="c1"># Then do this:</span>
</span><span class='line'><span class="nx">$</span><span class="p">(</span><span class="s">&#39;.input&#39;</span><span class="p">).</span><span class="nx">focusToEnd</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># A contains method for the String class</span>
</span><span class='line'><span class="k">if</span> <span class="o">not</span> <span class="nb">String</span><span class="o">::</span><span class="nx">contains</span> <span class="k">then</span> <span class="nb">String</span><span class="o">::</span><span class="nv">contains = </span><span class="nf">-&gt;</span> <span class="nb">String</span><span class="o">::</span><span class="nx">indexOf</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span> <span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span> <span class="p">)</span> <span class="o">isnt</span> <span class="o">-</span><span class="mi">1</span>
</span><span class='line'><span class="c1"># Use it like so:</span>
</span><span class='line'><span class="s">&quot;apple&quot;</span><span class="p">.</span><span class="nx">contains</span> <span class="s">&#39;app&#39;</span> <span class="c1"># returns true</span>
</span></code></pre></td></tr></table></div></figure>


<h3>onFinish</h3>

<p>A promise is not the swiss army knife of javascript tools. However it will get you out of hard and ugly situations with asynchronous code. $.ajax, $.post, and $.get all return deferreds that you can then listen in on. That is where the .done, .fail, .always methods come from in asnychronous jquery. Promises are a great way to finish the job, and at any time. Promise libraries exist other than Q, and I would recommend reading about the various other ones before deciding on Q. May promises help you in your developments. If you have any questions feel free to ask, I will respond, I promise.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Vincent Taverna</span></span>

      








  


<time datetime="2014-05-05T12:30:53-04:00" pubdate data-updated="true">May 5<span>th</span>, 2014</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/javascript/'>Javascript,</a>, <a class='category' href='/blog/categories/promises/'>Promises</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://vinnymac.github.io/blog/2014/05/05/promises-and-more/" data-via="kidtheflash" data-counturl="http://vinnymac.github.io/blog/2014/05/05/promises-and-more/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2014/04/28/html5-video-and-audio/" title="Previous Post: HTML5 Video and Audio">&laquo; HTML5 Video and Audio</a>
      
      
        <a class="basic-alignment right" href="/blog/2014/05/11/fragment-factories/" title="Next Post: Fragment Factories">Fragment Factories &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2014/05/18/boxview/">BoxView</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/05/11/fragment-factories/">Fragment Factories</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/05/05/promises-and-more/">Promises and More</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/04/28/html5-video-and-audio/">HTML5 Video and Audio</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/04/21/jasmine-and-teaspoon/">Jasmine and Teaspoon</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/vinnymac">@vinnymac</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'vinnymac',
            count: 5,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - Vincent Taverna -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
