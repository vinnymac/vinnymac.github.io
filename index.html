
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Dev Continuum</title>
  <meta name="author" content="Vincent Taverna">

  
  <meta name="description" content="onStart HTML5 makes placing an audio or video stream into your web app simple. However, not all browsers can use HTML5 (IE > 8, Chrome > 3, FF > 3). &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://vinnymac.github.io">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Dev Continuum" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Dev Continuum</a></h1>
  
    <h2>Web and Android Development</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:vinnymac.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/04/28/html5-video-and-audio/">HTML5 Video and Audio</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-04-28T16:27:05-04:00" pubdate data-updated="true">Apr 28<span>th</span>, 2014</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>onStart</h3>

<p>HTML5 makes placing an audio or video stream into your web app simple. However, not all browsers can use HTML5 (IE > 8, Chrome > 3, FF > 3). Many great solutions such as <a href="https://github.com/videojs/video.js">VideoJS</a> and <a href="http://kolber.github.io/audiojs/">AudioJS</a> try to alleviate that issue. In this article I will be going over how one might implement HTML5 video and audio in a dynamic and reusable fashion. The various features available when templating, and the tribulations when working with video and audio in javascript.</p>

<h3>Video and Audio Templates</h3>

<p>To begin let&rsquo;s see what HTML5 video and audio tags might look like in a template.</p>

<figure class='code'><figcaption><span>HTML5 Video and Audio Tagging</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='haml'><span class='line'># (poster, height, and width are video only features)
</span><span class='line'><span class="nt">%video</span><span class="nf">#movie</span><span class="p">{</span><span class="ss">height</span><span class="p">:</span> <span class="mi">640</span><span class="p">,</span> <span class="ss">width</span><span class="p">:</span> <span class="mi">480</span><span class="p">,</span> <span class="ss">poster</span><span class="p">:</span> <span class="s2">&quot;some.png&quot;</span><span class="p">,</span>
</span><span class='line'>              <span class="ss">controls</span><span class="p">:</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">autoplay</span><span class="p">:</span> <span class="kp">true</span><span class="p">,</span> <span class="kp">loop</span><span class="p">:</span> <span class="kp">true</span><span class="p">}</span>
</span><span class='line'>  <span class="nt">%source</span><span class="nf">#mp4</span><span class="p">{</span><span class="ss">src</span><span class="p">:</span> <span class="s1">&#39;rickroll.mp4&#39;</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="s1">&#39;video/mp4; codecs=&quot;avc1.42E01E, mp4a.40.2&quot;&#39;</span><span class="p">}</span>
</span><span class='line'>  <span class="nt">%source</span><span class="nf">#ogg</span> - # you can specify as many of these as you like, or just one.
</span><span class='line'>  Your browser does not support the video type or codec.
</span><span class='line'>
</span><span class='line'><span class="nt">%audio</span><span class="nf">#speakers</span><span class="p">{</span><span class="ss">preload</span><span class="p">:</span> <span class="n">auto</span><span class="p">,</span> <span class="ss">controls</span><span class="p">:</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">autoplay</span><span class="p">:</span> <span class="kp">true</span><span class="p">,</span> <span class="kp">loop</span><span class="p">:</span> <span class="kp">true</span><span class="p">}</span>
</span><span class='line'>  <span class="nt">%source</span><span class="nf">#mp3</span><span class="p">{</span><span class="ss">src</span><span class="p">:</span> <span class="s1">&#39;getlucky.mp3&#39;</span><span class="p">}</span>
</span><span class='line'>  Something terrible has occurred, run for your lives!
</span></code></pre></td></tr></table></div></figure>


<p>Above a HAML file contains an HTML5 video and audio tag. Let&rsquo;s go over some of their attributes. Looking at the video tag we can see I specified a height and width just like a div (video only). The controls attribute tells the browser to show the built in controls, it takes a boolean value. Autoplay makes the browser play the media automatically, and it takes a boolean value. Loop causes the media to play indefinitely, and it takes a boolean value. The poster attribute displays an image until the first frame of the video has loaded. An external or local image can be specified (video only). The preload attribute, which can be one of three things, none | metadata | auto. The media can also take a src attribute, but when dynamically controlling html5 video/audio it is easier to place a source tag underneath and specify the source manually or from JS. The source tag also allows for specifying the content type and codec of the video that will be playing. Lastly you can specify in plain text an error message, if the media you are trying to play is not supported. A list of all the <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/video">video attributes</a> and <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/audio">audio attributes</a> can be found on MDN.</p>

<h3>Dynamic Video and Audio</h3>

<p>Having control over the video and audio that may be playing is a desirable feature. Unfortunately you may want to use something jQuery to help you do this. Currently jQuery does not support HTML5 video and audio. You are going to have to use straight javascript (in my case coffeescript).</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="c1"># You cannot use jQuery to do this:</span>
</span><span class='line'><span class="c1"># @$(&#39;#movie&#39;).load()</span>
</span><span class='line'><span class="c1"># However you can get the first DOM element.</span>
</span><span class='line'><span class="nv">movie = </span><span class="nx">@$</span><span class="p">(</span><span class="s">&#39;#movie&#39;</span><span class="p">).</span><span class="nx">get</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="c1"># If you want to retain jQuery, use eq(0) instead.</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Optionally set the source in JS.</span>
</span><span class='line'><span class="nx">@$</span><span class="p">(</span><span class="s">&#39;#mp4&#39;</span><span class="p">).</span><span class="nx">get</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="nv">src = </span><span class="s">&#39;/rickroll.mp4&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># First you will need to load the video.</span>
</span><span class='line'><span class="nx">movie</span><span class="p">.</span><span class="nx">load</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Check if the video can be played, before playing it.</span>
</span><span class='line'><span class="nx">movie</span><span class="p">.</span><span class="nx">canPlayType</span><span class="p">(</span><span class="s">&#39;video/mp4&#39;</span><span class="p">)</span> <span class="c1"># returns &#39;maybe&#39;, &#39;probably&#39; or &#39;&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Then you can play it.</span>
</span><span class='line'><span class="nx">movie</span><span class="p">.</span><span class="nx">play</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># To pause you can call pause or trigger the event</span>
</span><span class='line'><span class="nx">movie</span><span class="p">.</span><span class="nx">pause</span><span class="p">()</span> <span class="c1"># or @$(&#39;#movie&#39;).trigger &#39;pause&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># For stopping playback all together, their are a few solutions.</span>
</span><span class='line'><span class="nx">movie</span><span class="p">.</span><span class="nx">pause</span><span class="p">()</span>
</span><span class='line'><span class="nv">movie.currentTime = </span><span class="mi">0</span>
</span><span class='line'><span class="c1"># or</span>
</span><span class='line'><span class="nv">movie.src = </span><span class="s">&#39;&#39;</span>
</span><span class='line'><span class="c1"># or</span>
</span><span class='line'><span class="nx">@$</span><span class="p">(</span><span class="s">&#39;#movie&#39;</span><span class="p">).</span><span class="nx">remove</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Several events exist that you can listen in on.</span>
</span><span class='line'><span class="c1"># How do I know when the first frame has loaded?</span>
</span><span class='line'><span class="nx">movie</span><span class="p">.</span><span class="nx">addEventListener</span> <span class="s">&#39;loadeddata&#39;</span><span class="p">,</span> <span class="nf">-&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="s">&#39;Done loading!&#39;</span>
</span><span class='line'><span class="c1"># How can I calculate the progress of a video?</span>
</span><span class='line'><span class="nx">movie</span><span class="p">.</span><span class="nx">addEventListener</span> <span class="s">&#39;progress&#39;</span><span class="p">,</span> <span class="nf">-&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="nx">@buffered</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="nx">@duration</span>
</span><span class='line'><span class="c1"># How do I know how far along the video is?</span>
</span><span class='line'><span class="nx">movie</span><span class="p">.</span><span class="nx">addEventListener</span> <span class="s">&#39;timeupdate&#39;</span><span class="p">,</span> <span class="nf">-&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="nx">@currentTime</span> <span class="o">/</span> <span class="nx">@duration</span>
</span></code></pre></td></tr></table></div></figure>


<p>All of the examples above would also work for audio, just replace the #movie id with the #speakers id. HTML5 is very feature rich. You can get just about any of the information that you could want when using these APIs. I only went over a few of the <a href="https://developer.mozilla.org/en-US/docs/Web/Guide/Events/Media_events">events that HTML5 offers</a>. I recommend reading over the rest to get a better grasp of the available tools.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="c1"># For audio you can use the built in Audio Constructor as well.</span>
</span><span class='line'><span class="nv">sound = </span><span class="k">new</span> <span class="nx">Audio</span> <span class="p">[</span><span class="s">&#39;http://musicdomain.com/getlucky.mp3&#39;</span><span class="p">]</span>
</span><span class='line'><span class="c1"># Preload gets set to auto by default.</span>
</span><span class='line'><span class="c1"># Sources aren&#39;t available as a fallback, so manually detect compatibility.</span>
</span><span class='line'><span class="k">unless</span> <span class="nx">sound</span><span class="p">.</span><span class="nx">canPlayType</span><span class="o">?</span> <span class="s">&#39;audio/mpeg&#39;</span>
</span><span class='line'>  <span class="c1"># An alternative like flash/silverlight goes here.</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Backbone Example</h3>

<p>Before wrapping up let&rsquo;s take a look at a real life example. This would be in the case that you were using Backbone, but any structural web application would work similarly. Below I have built a tiny MP3 player that is being controlled and styled through a backbone view, with custom play and pause button ids.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="k">class</span> <span class="nx">MP3Player</span> <span class="k">extends</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">View</span>
</span><span class='line'>  <span class="nv">template: </span><span class="s">&#39;mp3_player&#39;</span>
</span><span class='line'>  <span class="nv">events:</span>
</span><span class='line'>    <span class="s">&#39;click #play&#39;</span>  <span class="o">:</span> <span class="s">&#39;play&#39;</span>
</span><span class='line'>    <span class="s">&#39;click #pause&#39;</span> <span class="o">:</span> <span class="s">&#39;pause&#39;</span>
</span><span class='line'>  <span class="nv">initialize: </span><span class="nf">-&gt;</span> <span class="nx">@loadAudio</span><span class="p">()</span>
</span><span class='line'>  <span class="nv">loadAudio: </span><span class="nf">-&gt;</span>
</span><span class='line'>    <span class="vi">@$speakers = </span><span class="nx">@$</span><span class="p">(</span><span class="s">&#39;#speakers&#39;</span><span class="p">).</span><span class="nx">get</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span class='line'>    <span class="nx">@$</span><span class="p">(</span><span class="s">&#39;#mp3&#39;</span><span class="p">).</span><span class="nx">get</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="nv">src = </span><span class="s">&#39;http://musicdomain.com/getlucky.mp3&#39;</span>
</span><span class='line'>    <span class="nx">@load</span><span class="p">()</span>
</span><span class='line'>  <span class="nv">load: </span><span class="nf">-&gt;</span> <span class="nx">@$speakers</span><span class="p">.</span><span class="nx">load</span><span class="p">()</span>
</span><span class='line'>  <span class="nv">play: </span><span class="nf">-&gt;</span> <span class="nx">@$speakers</span><span class="p">.</span><span class="nx">play</span><span class="p">()</span>
</span><span class='line'>  <span class="nv">pause: </span><span class="nf">-&gt;</span> <span class="nx">@$speakers</span><span class="p">.</span><span class="nx">pause</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<p>I found that when using HTML5 video and audio in a structural app, the code is more readable. Through a combination of backbone and coffeescript you can create a clean and concise video or audio player. Wrapping the video or audio tags in a container allows you to customize many aspects. Which allows for things like custom control interfaces. Using the timeupdate event you could display a message to the user as they progress or finish streaming. Things can get tricky at times because of the lack of jQuery support. But keep in mind that if you fall back to basic javascript things will work out just fine.</p>

<h3>onFinish</h3>

<p>Some may argue that the HTML5 Video and Audio APIs aren&rsquo;t worth introducing yet. Many implementations always have to offer a fallback option using Flash or an alternative like Silverlight. If you take a look at Soundcloud or Youtube, to this day you have to go into some experimental mode just to turn on HTML5 media playback. On top of that browsers differ in their implementation of the HTML5 API and so you have to tiptoe around when using it. This has been the case for most internet related things since the beginning of time, so I doubt this will deter anyone from using it. If you find yourself struggling feel free to contact me. Also the VideoJS and AudioJS libs take care of the majority of failure cases and allow for easy styling out of the box.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/04/21/jasmine-and-teaspoon/">Jasmine and Teaspoon</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-04-21T23:59:13-04:00" pubdate data-updated="true">Apr 21<span>st</span>, 2014</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>onStart</h3>

<p>In the case of writing tests for your javascript/coffeescript apps you will find that Jasmine is one of the best options. It is easy to add to by improving its matchers, and it is flexible enough to test more difficult subjects like asynchronous calls or mock/stub events and data. If you are currently looking for a way to test the front end of your website or javascript app you will not regret using jasmine to do so.</p>

<h3>Getting Started with Teaspoon</h3>

<p>When testing with Jasmine I found it easiest to use <a href="https://github.com/modeset/teaspoon">Teaspoon</a> alongside to easily setup a testing environment. Teaspoon has many benefits. They offer support for command line testing as well as testing in the browser. Teaspoon automatically generates a spec helper so that you can easily require your front end app. Combine this with Stub/Mocking with <a href="https://github.com/froots/jasmine-sinon">jasmine-sinon</a> and <a href="https://github.com/velesin/jasmine-jquery">jasmine-jquery</a> and you will have all the testing tools you could want on the front end.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># Add these lines to your Gemfile</span>
</span><span class='line'><span class="n">group</span> <span class="ss">:development</span><span class="p">,</span> <span class="ss">:test</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">gem</span> <span class="s2">&quot;teaspoon&quot;</span>
</span><span class='line'>  <span class="c1"># Teaspoon can use selenium or phantomjs</span>
</span><span class='line'>  <span class="c1"># gem &quot;phantomjs&quot;, &quot;&gt;= 1.8.1.1&quot;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>After setting up your gemfile, you can run bundler. Then execute the following line in your terminal. You can specify a framework, in my case I am using Jasmine, but Teaspoon supports other as well, such as Mocha. I also love to use coffeescript when testing, so I append &mdash;coffee to the end of the command to tell Teaspoon I will be writing coffee files.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">rails</span> <span class="n">generate</span> <span class="ss">teaspoon</span><span class="p">:</span><span class="n">install</span> <span class="o">--</span><span class="n">framework</span><span class="o">=</span><span class="n">jasmine</span> <span class="o">--</span><span class="n">coffee</span>
</span></code></pre></td></tr></table></div></figure>


<p>You can run your tests by visiting <a href="http://localhost:3000/teaspoon.">http://localhost:3000/teaspoon.</a> Where 3000 is the port you run your server on.
Alternatively you can run the Teaspoon test suites by typing rake teaspoon in the command line. They both have benefits, but ultimately you may find yourself wanting to run your tests using Guard. That way you can run your tests while you develop. If you are interested in using Guard with Teaspoon, I recommend reading about <a href="https://github.com/modeset/guard-teaspoon">guard-teaspoon</a>.</p>

<h3>Writing Jasmine Tests</h3>

<p>Now that you have setup Teaspoon you can get to the fun part. I recommend reading Jasmines documentation, they have a lot of great examples on the various types of tests you may come across when testing a front end. In my case below, I am testing my backbone model Person, and the attributes that exist on it by default. If you want open a new file in the jasmine folder that Teaspoon generated. In my case it would be person_spec.coffee.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="nx">describe</span> <span class="s">&quot;Person&quot;</span><span class="p">,</span> <span class="nf">-&gt;</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># If you want to do something before each test</span>
</span><span class='line'>  <span class="nx">beforeEach</span> <span class="nf">-&gt;</span>
</span><span class='line'>    <span class="nv">person = </span><span class="k">new</span> <span class="nx">People</span><span class="p">.</span><span class="nx">Person</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">it</span> <span class="s">&#39;should be alive&#39;</span><span class="p">,</span> <span class="nf">-&gt;</span>
</span><span class='line'>    <span class="nx">expect</span><span class="p">(</span><span class="nx">person</span><span class="p">).</span><span class="nx">toBeDefined</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">it</span> <span class="s">&#39;should have a name&#39;</span><span class="p">,</span> <span class="nf">-&gt;</span>
</span><span class='line'>    <span class="nx">expect</span><span class="p">(</span><span class="nx">person</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s">&#39;name&#39;</span><span class="p">)).</span><span class="nx">toBeString</span><span class="p">()</span> <span class="c1"># underscore method</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">it</span> <span class="s">&#39;should have a favorite food&#39;</span><span class="p">,</span> <span class="nf">-&gt;</span>
</span><span class='line'>    <span class="nx">expect</span><span class="p">(</span><span class="nx">person</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s">&#39;food&#39;</span><span class="p">)).</span><span class="nx">toBe</span><span class="p">(</span><span class="s">&quot;Pizza&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">it</span> <span class="s">&#39;should have an identification&#39;</span><span class="p">,</span> <span class="nf">-&gt;</span>
</span><span class='line'>    <span class="nx">expect</span><span class="p">(</span><span class="nx">person</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s">&#39;id&#39;</span><span class="p">)).</span><span class="nx">toBeNumber</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># If you want to write the boilerplate</span>
</span><span class='line'>  <span class="c1"># for a test you haven&#39;t finished yet</span>
</span><span class='line'>  <span class="nx">xit</span> <span class="s">&#39;can die&#39;</span><span class="p">,</span> <span class="nf">-&gt;</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># Testing a method on a model</span>
</span><span class='line'>  <span class="nx">it</span> <span class="s">&#39;should have a creator&#39;</span><span class="p">,</span> <span class="nf">-&gt;</span>
</span><span class='line'>    <span class="nx">expect</span><span class="p">(</span><span class="nx">person</span><span class="p">.</span><span class="nx">creator</span><span class="p">()).</span><span class="nx">toBe</span><span class="p">(</span><span class="s">&quot;Vinny&quot;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Creating Matchers</h3>

<p>So now that you have written a test, maybe you want to expand the tools you have at your disposal when testing in Jasmine. Matchers make it easy to create new tools you can use for testing. If you have the <a href="http://underscorejs.org/">UnderscoreJS</a> library, you can easily add some matchers to Jasmine that will make testing better. In order to start adding matchers, open up your spec_helper file that Teaspoon generated. At the end of this file you can add any matchers you might want when writing your tests.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="nx">beforeEach</span> <span class="nf">-&gt;</span> <span class="c1"># Executes this code before each test.</span>
</span><span class='line'>  <span class="nx">@addMatchers</span> <span class="c1"># Tells Jasmine to add these matchers</span>
</span><span class='line'>    <span class="nv">toBeOfType: </span><span class="nf">(type) -&gt;</span>
</span><span class='line'>      <span class="k">return</span> <span class="k">typeof</span> <span class="nx">@actual</span> <span class="o">is</span> <span class="nx">type</span> <span class="c1"># @actual points to the expected value</span>
</span><span class='line'>    <span class="nv">toBeNaN: </span><span class="nf">-&gt;</span>
</span><span class='line'>      <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nb">isNaN</span> <span class="nx">@actual</span>
</span><span class='line'>    <span class="nv">toBeDate: </span><span class="nf">-&gt;</span>
</span><span class='line'>      <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isDate</span> <span class="nx">@actual</span>
</span><span class='line'>    <span class="nv">toBeEmpty: </span><span class="nf">-&gt;</span>
</span><span class='line'>      <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isEmpty</span> <span class="nx">@actual</span>
</span><span class='line'>    <span class="nv">toBeArray: </span><span class="nf">-&gt;</span>
</span><span class='line'>      <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isArray</span> <span class="nx">@actual</span>
</span><span class='line'>    <span class="nv">toBeObject: </span><span class="nf">-&gt;</span>
</span><span class='line'>      <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isObject</span> <span class="nx">@actual</span>
</span><span class='line'>    <span class="nv">toBeRegExp: </span><span class="nf">-&gt;</span>
</span><span class='line'>      <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isRegExp</span> <span class="nx">@actual</span>
</span><span class='line'>    <span class="nv">toBeFinite: </span><span class="nf">-&gt;</span>
</span><span class='line'>      <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nb">isFinite</span> <span class="nx">@actual</span>
</span><span class='line'>    <span class="nv">toBeString: </span><span class="nf">-&gt;</span>
</span><span class='line'>      <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isString</span> <span class="nx">@actual</span>
</span><span class='line'>    <span class="nv">toBeNumber: </span><span class="nf">-&gt;</span>
</span><span class='line'>      <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isNumber</span> <span class="nx">@actual</span>
</span><span class='line'>    <span class="nv">toBeElement: </span><span class="nf">-&gt;</span>
</span><span class='line'>      <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isElement</span> <span class="nx">@actual</span>
</span><span class='line'>    <span class="nv">toBeBoolean: </span><span class="nf">-&gt;</span>
</span><span class='line'>      <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isBoolean</span> <span class="nx">@actual</span>
</span><span class='line'>    <span class="nv">toBeFunction: </span><span class="nf">-&gt;</span>
</span><span class='line'>      <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isFunction</span> <span class="nx">@actual</span>
</span><span class='line'>    <span class="nv">toHaveArguments: </span><span class="nf">-&gt;</span>
</span><span class='line'>      <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isArguments</span> <span class="nx">@actual</span>
</span></code></pre></td></tr></table></div></figure>


<p>By using a library like underscore you retain the testing environment that Jasmine creates, even when doing comparisons like expecting a handful of arguments. By adding matchers your tests become more clear and concise. Being able to write thin self explanatory tests is priceless. Especially when the magic is coming from a spec helper that you yourself have written.</p>

<h3>onFinish</h3>

<p>Hopefully this brief overview of Teaspoon will give you the jump start you need to get into front end testing. Testing is invaluable, and I recommend doing it for more than just your front end if you can. If you have any problems while testing with Jasmine or just want some help, leave a comment below.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/04/14/client-side-exif/">Client-Side EXIF</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-04-14T09:59:53-04:00" pubdate data-updated="true">Apr 14<span>th</span>, 2014</time>
        
      </p>
    
  </header>


  <div class="entry-content"><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'>  <span class="mi">1</span>        <span class="mi">2</span>       <span class="mi">3</span>      <span class="mi">4</span>         <span class="mi">5</span>            <span class="mi">6</span>           <span class="mi">7</span>          <span class="mi">8</span>
</span><span class='line'>
</span><span class='line'><span class="c1">######  ######      ##  ##      ##########  ##                  ##  ##########</span>
</span><span class='line'><span class="c1">##          ##      ##  ##      ##  ##      ##  ##          ##  ##      ##  ##</span>
</span><span class='line'><span class="c1">####      ####    ####  ####    ##          ##########  ##########          ##</span>
</span><span class='line'><span class="c1">##          ##      ##  ##</span>
</span><span class='line'><span class="c1">##          ##  ######  ######</span>
</span></code></pre></td></tr></table></div></figure>


<h3>onStart</h3>

<p>Images with exif data are often not that easy to handle. Manipulating images on the client and passing around metadata can be a slow and painful process. I have used many of the options available to one when trying to get exif in JavaScript. This is a review of several viable options for getting exif from an image.</p>

<p>For testing purposes throughout this review I recommend using images with exif data intact. Dave Perret has a pack of them <a href="https://github.com/recurser/exif-orientation-examples">over on github</a> that you can download.</p>

<h3>Image Orientation in Firefox</h3>

<p>Althought this doesn&rsquo;t deal with extracting EXIF, it is worth mentioning for those looking for a solution to orientation problems. The only browser which actually allows for image orientation correction right now is <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/image-orientation#Browser_compatibility">Firefox 26 beta or above</a>. Adding this feature is very simple. Just apply the image-orientation style using css to any image tag. <a href="https://code.google.com/p/chromium/issues/detail?id=158753">Unfortunately chrome has yet to implement this feature</a> and the only way to see correctly oriented images is by having an image at the <a href="https://code.google.com/p/chromium/issues/detail?id=56845#c66">top level of the DOM</a>. As time passes this feature will become adopted, and possibly images will be rotated automatically.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;img</span> <span class="na">style=</span><span class="s">&quot;image-orientation: from-image&quot;</span> <span class="na">src=</span><span class="s">&quot;image.jpg&quot;</span><span class="nt">&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>See for yourself how this works in <a href="http://jsfiddle.net/L3S7R/">my example</a>. Firefox will return the best results, but you should be able to try it in any browser you have installed. Documentation for the image-orientation style can be <a href="http://dev.w3.org/csswg/css3-images/#image-orientation">found on w3</a>.</p>

<h3>Load-Image Library</h3>

<p>This library is great at, you guessed it, loading images! It has the idea of mix and matching behind its implementation. You can grab the exif and the main library and start parsing data with very few lines of code. After parsing the exif data out, you have to load the image again. This isn&rsquo;t great for performance but it does work very well. Try it out for yourself <a href="https://github.com/blueimp/JavaScript-Load-Image">here</a>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="c1"># Parsing the Metadata</span>
</span><span class='line'><span class="nx">loadImage</span><span class="p">.</span><span class="nx">parseMetaData</span> <span class="nx">file</span><span class="p">,</span> <span class="nf">(data) -&gt;</span>
</span><span class='line'>  <span class="nv">options = </span><span class="p">{}</span>
</span><span class='line'>  <span class="k">if</span> <span class="nx">data</span><span class="p">.</span><span class="nx">exif</span>
</span><span class='line'>    <span class="nv">options.orientation = </span><span class="nx">data</span><span class="p">.</span><span class="nx">exif</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s">&#39;Orientation&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="nv">options.canvas = </span><span class="kc">true</span> <span class="c1"># tells loadImage we want a canvas returned</span>
</span><span class='line'>  <span class="c1"># Load the Image with new options</span>
</span><span class='line'>  <span class="nx">loadImage</span> <span class="nx">file</span><span class="p">,</span> <span class="nf">(image) -&gt;</span>
</span><span class='line'>    <span class="nx">$</span><span class="p">(</span><span class="s">&#39;some_div&#39;</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="nx">image</span><span class="p">)</span>
</span><span class='line'>  <span class="p">,</span> <span class="nx">options</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># You could also scale an image</span>
</span><span class='line'><span class="nv">canvas = </span><span class="nx">loadImage</span><span class="p">.</span><span class="nx">scale</span> <span class="nx">image</span><span class="p">,</span>
</span><span class='line'>  <span class="nv">left: </span><span class="mi">0</span>
</span><span class='line'>  <span class="nv">top: </span><span class="mi">0</span>
</span><span class='line'>  <span class="nv">sourceWidth: </span><span class="nx">image</span><span class="p">.</span><span class="nx">width</span>
</span><span class='line'>  <span class="nv">sourceHeight: </span><span class="nx">image</span><span class="p">.</span><span class="nx">height</span>
</span><span class='line'>  <span class="nv">maxWidth: </span><span class="nx">target_width</span>
</span><span class='line'>  <span class="nv">maxHeight: </span><span class="nx">target_height</span>
</span></code></pre></td></tr></table></div></figure>


<p>As you can see the Load-Image lib allows for a lot more than just exif extraction. You can manipulate images in many ways using this tool. The downsides are that this doesn&rsquo;t use a web worker, so you cannot count on this when doing other performance heavy operations. If you would like to test this out for yourself, they have <a href="http://blueimp.github.io/JavaScript-Load-Image/">a great demo</a>.</p>

<h3>EXIF and BinaryAJAX</h3>

<p>Although old, these two files will allow you to extract EXIF meta data from JPEG images. This is best used with the FileReader API available on most modern browsers.
<a href="http://www.nihilogic.dk/labs/exif/exif.js">EXIF</a> and <a href="http://www.nihilogic.dk/labs/binaryajax/binaryajax.js">BinaryAJAX</a> are available at <a href="http://nihilogic.dk">http://nihilogic.dk</a> . Below is an example of using the FileReader to load the image, and then extract the exif with EXIF and BinaryAJAX.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="nv">image = </span><span class="nx">@files</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># Get the first file from the user</span>
</span><span class='line'><span class="nv">reader = </span><span class="k">new</span> <span class="nx">FileReader</span>
</span><span class='line'><span class="nv">reader.onloadend = </span><span class="nf">-&gt;</span>
</span><span class='line'>  <span class="nv">exif = </span><span class="nx">EXIF</span><span class="p">.</span><span class="nx">readFromBinaryFile</span> <span class="k">new</span> <span class="nx">BinaryFile</span> <span class="nx">@result</span>
</span><span class='line'><span class="nx">reader</span><span class="p">.</span><span class="nx">readAsBinaryString</span> <span class="nx">image</span>
</span></code></pre></td></tr></table></div></figure>


<p>The advantage of this library is that it doesn&rsquo;t require much, and you do not have to load the image many times. All it really requires is the use of the File API. The downside is you don&rsquo;t get the advantages of manipulating the images, or resizing properly. All you get is the EXIF data. Seeing as this one is outdated, I would just <a href="http://sandbox.juurlink.org/html5imageuploader/">give it a try</a> or try the more <a href="http://jsfiddle.net/interstateone/gtLWG/">code friendly example</a>. Visit the github page <a href="https://github.com/jseidelin/exif-js">here</a> for more information.</p>

<h3>Flickr&rsquo;s EXIF Extraction</h3>

<p><a href="http://code.flickr.net/2012/06/01/parsing-exif-client-side-using-javascript-2/">Flickr has a great write up</a> in regards to extracting the metadata using web workers. Web workers appear to be a very performant option. Similarly to the example above, you need to use the FileReader API, but more efficiently slice off only the part of the image that contains the exif data. When working with the exif data in a web worker, the EXIF tag for orientation will be at offset 0x112.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="c1"># Slice up the section of the file that contains the exif (128 KiloBytes = 131072 Bytes)</span>
</span><span class='line'><span class="k">if</span> <span class="nx">file</span><span class="p">.</span><span class="nx">slice</span>
</span><span class='line'>  <span class="nv">filePart = </span><span class="nx">file</span><span class="p">.</span><span class="nx">slice</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">131072</span>
</span><span class='line'><span class="k">else</span> <span class="k">if</span> <span class="nx">file</span><span class="p">.</span><span class="nx">webkitSlice</span>
</span><span class='line'>  <span class="nv">filePart = </span><span class="nx">file</span><span class="p">.</span><span class="nx">webkitSlice</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">131072</span>
</span><span class='line'><span class="k">else</span> <span class="k">if</span> <span class="nx">file</span><span class="p">.</span><span class="nx">mozSlice</span>
</span><span class='line'>  <span class="nv">filePart = </span><span class="nx">file</span><span class="p">.</span><span class="nx">mozSlice</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">131072</span>
</span><span class='line'><span class="k">else</span>
</span><span class='line'>  <span class="nv">filePart = </span><span class="nx">file</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Read part of the file, then send it to our worker for processing</span>
</span><span class='line'><span class="nv">reader = </span><span class="k">new</span> <span class="nx">FileReader</span>
</span><span class='line'><span class="nv">reader.onload = </span><span class="nf">-&gt;</span>
</span><span class='line'>  <span class="c1"># Refers to a worker you must define</span>
</span><span class='line'>  <span class="nv">jobBlob = </span><span class="k">new</span> <span class="nx">Blob</span> <span class="p">[</span><span class="nx">workers</span><span class="p">.</span><span class="nx">exif_processor</span><span class="p">],</span> <span class="p">{</span><span class="nv">type: </span><span class="s">&quot;text/javascript&quot;</span><span class="p">}</span>
</span><span class='line'>  <span class="nv">worker = </span><span class="k">new</span> <span class="nx">Worker</span> <span class="nx">URL</span><span class="p">.</span><span class="nx">createObjectURL</span> <span class="nx">jobBlob</span>
</span><span class='line'>  <span class="nx">worker</span><span class="p">.</span><span class="nx">addEventListener</span> <span class="s">&#39;message&#39;</span><span class="p">,</span> <span class="nf">(e) -&gt;</span>
</span><span class='line'>    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="s">&quot;Exif Orientation Data:&quot;</span><span class="p">,</span> <span class="nx">e</span><span class="p">.</span><span class="nx">data</span>
</span><span class='line'>  <span class="nx">worker</span><span class="p">.</span><span class="nx">postMessage</span>
</span><span class='line'>    <span class="nv">binary: </span><span class="nx">@result</span>
</span><span class='line'><span class="nx">reader</span><span class="p">.</span><span class="nx">readAsBinaryString</span> <span class="nx">filePart</span>
</span></code></pre></td></tr></table></div></figure>


<p>Using Web Workers to process the exif data is the fastest way to correcting your images. You may even be able to get web workers working with one of the examples above. Flickr used to acquire most of the metadata server side, but now they moved over to doing it on the client. Hopefully this will convince others to do the same, and we can get the webs images looking better than they have in the past.</p>

<h3>onFinish</h3>

<p>Consistent exif orientation handling is wack on the web, <a href="http://www.daveperrett.com/articles/2012/07/28/exif-orientation-handling-is-a-ghetto/">a great article on this topic</a>, goes into detail about the current state of orientation handling. If you think you know a better way, or an alternative to the methods I went over here, please let me know. Extracting EXIF is hard enough, having to manipulate images after is overkill.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/04/07/aviarys-featherjs-in-backbone-dot-marionette/">Aviary&#8217;s FeatherJS in Backbone.Marionette</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-04-07T01:01:35-04:00" pubdate data-updated="true">Apr 7<span>th</span>, 2014</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>To get started head over to the <a href="http://developers.aviary.com/" title="Dev Page">Developer Page</a> and sign up. Select the HTML 5 app and generate an api key. Place featherjs in a <a href="http://feather.aviary.com/js/feather.js" title="FeatherJS">script tag or download it</a>.</p>

<p>Now in your Backbone.Marionette app you are going to either create a new ItemView or navigate to an existing one you want aviary to be launched from.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="k">class</span> <span class="nx">App</span><span class="p">.</span><span class="nx">AvatarView</span> <span class="k">extends</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Marionette</span><span class="p">.</span><span class="nx">ItemView</span>
</span><span class='line'>  <span class="nv">template: </span><span class="s">&#39;avatar&#39;</span>
</span><span class='line'>  <span class="nv">className: </span><span class="s">&#39;avatar_view&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Initialize Aviary by creating an instance of Feather JS. Do this in the initialize method of the ItemView. Here we construct what Aviary&rsquo;s Editor will do throughout its use. When the user finishes saving the photo, a url is returned. You are left with several options. Insert the url into the DOM using the image id, save the new url to an attribute on your Backbone model, or directly post the url to your server. Make sure you store your api_key somewhere so you can access it from anywhere you might need to launch aviary. For this example I&rsquo;ll store it in window.aviary_api_key.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="nv">initialize: </span><span class="nf">-&gt;</span>
</span><span class='line'>  <span class="vi">@featherEditor = </span><span class="k">new</span> <span class="nx">Aviary</span><span class="p">.</span><span class="nx">Feather</span>
</span><span class='line'>    <span class="nv">apiKey: </span><span class="nx">aviary_api_key</span>
</span><span class='line'>    <span class="nv">apiVersion: </span><span class="mi">3</span> <span class="c1"># The latest api version</span>
</span><span class='line'>    <span class="nv">tools: </span><span class="p">[</span><span class="s">&#39;stickers&#39;</span><span class="p">,</span> <span class="s">&#39;crop&#39;</span><span class="p">]</span>
</span><span class='line'>    <span class="nv">onSave: </span><span class="nf">(id, url) -&gt;</span>
</span><span class='line'>      <span class="nx">@model</span><span class="p">.</span><span class="nx">save</span>
</span><span class='line'>        <span class="nv">avatar_url: </span><span class="nx">url</span>
</span><span class='line'>      <span class="k">return</span> <span class="kc">false</span> <span class="c1"># ignores the save/confirm dialog</span>
</span><span class='line'>    <span class="nv">theme: </span><span class="s">&#39;light&#39;</span> <span class="c1"># dark by default</span>
</span><span class='line'>    <span class="nv">noCloseButton: </span><span class="kc">true</span> <span class="c1"># You can force the user to continue using aviary this way.</span>
</span></code></pre></td></tr></table></div></figure>


<p>Aviary also provides callback methods like onClose and onReady for additional control during various points of user interaction. Another useful param is postUrl. This allows you to post the newly edited photo to a route on your server or wherever you would like.</p>

<p>You&rsquo;re going to need a method that can start aviary from an event or some other place in your view. Let&rsquo;s call this method launchEditor.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="nv">launchEditor: </span><span class="nf">(id, src) -&gt;</span>
</span><span class='line'>  <span class="c1"># load a url now or pass it into this function</span>
</span><span class='line'>  <span class="nx">@featherEditor</span><span class="p">.</span><span class="nx">launch</span>
</span><span class='line'>    <span class="nv">image: </span><span class="nx">id</span>
</span><span class='line'>    <span class="nv">url: </span><span class="nx">src</span>
</span><span class='line'>  <span class="k">return</span> <span class="kc">false</span>
</span></code></pre></td></tr></table></div></figure>


<p>If you would like to add a default cropping ratio you can do so by adding a &lsquo;forceCropPreset&rsquo; to the params on launch like so.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="nx">@featherEditor</span><span class="p">.</span><span class="nx">launch</span>
</span><span class='line'>  <span class="nv">image: </span><span class="nx">id</span>
</span><span class='line'>  <span class="nv">url: </span><span class="nx">src</span>
</span><span class='line'>  <span class="nv">forceCropPreset: </span><span class="p">[</span><span class="s">&#39;My Default&#39;</span><span class="p">,</span> <span class="s">&#39;1:1&#39;</span><span class="p">]</span>
</span><span class='line'>  <span class="nv">forceCropMessage: </span><span class="s">&#39;Please Crop your Avatar&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>At this point you can test that aviary is properly launching after calling the &lsquo;launchEditor&rsquo; method. You may want to add a click listener to launch it. If you have a class named avatar, you could add an event to launch it.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="nv">events:</span>
</span><span class='line'>  <span class="s">&#39;click .avatar&#39;</span> <span class="o">:</span> <span class="s">&#39;launchEditor&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Aviary has <a href="http://developers.aviary.com/docs/web/setup-guide" title="Aviary's Feather Documentation">documentation</a> on implementing feather. I don&rsquo;t recommend reading the entire thing. Only pieces of it are useful for specific instances of aviary. I went over some of the more useful features you may want when using it with Avatars. But you can mix and match Aviary&rsquo;s editor to fit your needs. Take a look at the various tools the editor offers to see what I mean.</p>

<p>Remember, every external library comes with its hardships. Although it seems very simple to implement, Aviary only allows external resources to be used as (a publicly available file that they process) the url source. The url they return to you is always one from there servers. So if you don&rsquo;t feel comfortable with aviary touching your users data remotely, I would look for other options. Such as manually cropping photos using the HTML 5 Canvas.</p>

<p>Note: I had trouble with IE9, they claim to support it but I received &lsquo;Not Enough Storage&rsquo; errors when launching Feather in IE. It appeared to be an issue with cascading style sheets, let me know if you have a similar result.</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
    <a href="/blog/archives">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2014/04/28/html5-video-and-audio/">HTML5 Video and Audio</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/04/21/jasmine-and-teaspoon/">Jasmine and Teaspoon</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/04/14/client-side-exif/">Client-Side EXIF</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/04/07/aviarys-featherjs-in-backbone-dot-marionette/">Aviary&#8217;s FeatherJS in Backbone.Marionette</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/vinnymac">@vinnymac</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'vinnymac',
            count: 5,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - Vincent Taverna -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
