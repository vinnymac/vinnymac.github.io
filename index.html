
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Dev Continuum</title>
  <meta name="author" content="Vincent Taverna">

  
  <meta name="description" content="onStart Rails is one of the most popular frameworks right now. It contains a lot of magic, and that can often be credited to its asset pipeline. &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://vinnymac.github.io">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Dev Continuum" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Dev Continuum</a></h1>
  
    <h2>Web and Android Development</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:vinnymac.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/05/26/sinatra-assets/">Sinatra Assets</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-05-26T15:32:56-04:00" pubdate data-updated="true">May 26<span>th</span>, 2014</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>onStart</h3>

<p>Rails is one of the most popular frameworks right now. It contains a lot of magic, and that can often be credited to its asset pipeline. Frequently when I think of Sinatra I think of it as a slim downed version of Rails. It has its uses, and so does Rails, but what if we wanted to combine Sinatra with an asset pipeline. I decided to do a little digging, and after doing a little research, I discovered that their is only one good solution that exists right now. It is called the <a href="https://github.com/rstacruz/sinatra-assetpack">Sinatra AssetPack</a>.</p>

<h3>Sinatra AssetPack</h3>

<p>In order to get started using the Sinatra AssetPack you will need to add it to your Gemfile.</p>

<figure class='code'><figcaption><span>Gemfile</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">gem</span> <span class="s1">&#39;sinatra-assetpack&#39;</span><span class="p">,</span> <span class="ss">:require</span> <span class="o">=&gt;</span> <span class="s1">&#39;sinatra/assetpack&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Then run bundle (or bundle install), and let it install. Once installed you can start taking advantage of the Sinatra AssetPack. I added it to the base of my Sinatra app, I would recommend you do the same.</p>

<figure class='code'><figcaption><span>Base</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s1">&#39;sinatra/base&#39;</span>
</span><span class='line'><span class="nb">require</span> <span class="s1">&#39;sinatra/assetpack&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">MyApp</span> <span class="o">&lt;</span> <span class="ss">Sinatra</span><span class="p">:</span><span class="ss">:Base</span>
</span><span class='line'>  <span class="n">set</span> <span class="ss">:root</span><span class="p">,</span> <span class="no">File</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">__FILE__</span><span class="p">)</span>
</span><span class='line'>  <span class="n">set</span> <span class="ss">:views</span><span class="p">,</span> <span class="n">settings</span><span class="o">.</span><span class="n">root</span> <span class="o">+</span> <span class="s1">&#39;/views&#39;</span>
</span><span class='line'>  <span class="n">set</span> <span class="ss">:public_folder</span><span class="p">,</span> <span class="n">settings</span><span class="o">.</span><span class="n">root</span> <span class="o">+</span> <span class="s1">&#39;/public&#39;</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">register</span> <span class="ss">Sinatra</span><span class="p">:</span><span class="ss">:AssetPack</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">assets</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">serve</span> <span class="s1">&#39;/js&#39;</span><span class="p">,</span>     <span class="ss">from</span><span class="p">:</span> <span class="s1">&#39;app/js&#39;</span>
</span><span class='line'>    <span class="n">serve</span> <span class="s1">&#39;/css&#39;</span><span class="p">,</span>    <span class="ss">from</span><span class="p">:</span> <span class="s1">&#39;app/css&#39;</span>
</span><span class='line'>    <span class="n">serve</span> <span class="s1">&#39;/images&#39;</span><span class="p">,</span> <span class="ss">from</span><span class="p">:</span> <span class="s1">&#39;app/images&#39;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1"># Serve up JS per request</span>
</span><span class='line'>    <span class="n">js</span> <span class="ss">:app</span><span class="p">,</span> <span class="s1">&#39;/js/app.js&#39;</span><span class="p">,</span> <span class="o">[</span>
</span><span class='line'>      <span class="s1">&#39;/js/vendor/**/*.js&#39;</span><span class="p">,</span>
</span><span class='line'>      <span class="s1">&#39;/js/lib/**/*.js&#39;</span>
</span><span class='line'>    <span class="o">]</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1"># Serve up CSS per request</span>
</span><span class='line'>    <span class="n">css</span> <span class="ss">:application</span><span class="p">,</span> <span class="s1">&#39;/css/application.css&#39;</span><span class="p">,</span> <span class="o">[</span>
</span><span class='line'>      <span class="s1">&#39;/css/screen.css&#39;</span>
</span><span class='line'>    <span class="o">]</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1"># jsmin, yui, closure or uglify for js compression</span>
</span><span class='line'>    <span class="n">js_compression</span>  <span class="ss">:uglify</span>
</span><span class='line'>    <span class="c1"># simple, sass, yui, or sqwish for css compression</span>
</span><span class='line'>    <span class="n">css_compression</span> <span class="ss">:sass</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">get</span> <span class="s1">&#39;/&#39;</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">haml</span> <span class="ss">:index</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>With the Sinatra AssetPack you can minify/obfuscate your js and css files. It will help you clean up your routes as well. By serving up only the files you need, you can specify exactly what js and css files for your Sinatra app when hitting a particular route. I found out of all the available options, this was the simplest</p>

<h3>The Pipeline</h3>

<p>After configuring your app like I did above, you will be able to use the pipeline in your static files. In this example I am using haml. It is very simple to include your js/css/haml files using this type of pipeline.</p>

<figure class='code'><figcaption><span>Index</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='haml'><span class='line'><span class="p">=</span> <span class="n">haml</span> <span class="ss">:browser_compat</span>
</span><span class='line'><span class="nt">%html</span>
</span><span class='line'>  <span class="nt">%header</span>
</span><span class='line'>    <span class="p">=</span> <span class="n">haml</span> <span class="ss">:header</span> <span class="c1"># header contains != css :application</span>
</span><span class='line'>  <span class="nt">%body</span>
</span><span class='line'>    <span class="nc">.container</span>
</span><span class='line'>      <span class="nc">.navigation</span>
</span><span class='line'>        <span class="p">=</span> <span class="n">haml</span> <span class="ss">:navigation</span>
</span><span class='line'>      <span class="nc">.stage</span>
</span><span class='line'>        <span class="p">=</span> <span class="n">haml</span> <span class="ss">:stage</span>
</span><span class='line'>      <span class="nc">.footer</span>
</span><span class='line'>        <span class="p">=</span> <span class="n">haml</span> <span class="ss">:footer</span>
</span><span class='line'>    <span class="nf">#js_footer</span>
</span><span class='line'>      <span class="p">!=</span> <span class="n">js</span> <span class="ss">:app</span>
</span></code></pre></td></tr></table></div></figure>


<p>This results in very clean and readable haml. The pieces here are reusable, and by following this pipeline you start to modularize your Sinatra application. I hope more apps use this, as it brings the magic of Rails to Sinatra apps, which tend to be more simplistic.</p>

<h3>onFinish</h3>

<p>Not everyone will need an asset pipeline in their web app. This is for those that require a clean and reusable code base for an app that is based on Sinatra. I find that modularizing your js and css will help a lot. Especially when you get obfuscation for free with it. Sinatra can be a powerful web application framework, and tools like this can make it even better. If you require any assistance setting up Sinatra AssetPack let me know.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/05/18/boxview/">BoxView</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-05-18T21:51:11-04:00" pubdate data-updated="true">May 18<span>th</span>, 2014</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>onStart</h3>

<p>The <a href="https://developers.box.com/view/">BoxViewAPI</a> is useful for displaying documents in the browser without needing to do any heavy lifting. You can quickly turn any PDF, MS Document, or MS PowerPoint into HTML and display it inline on your website. The HTML is hosted by Box, and you can easily display this on your site by using an iFrame. Alternatively you could download the HTML and display it with viewer.js. Make sure you <a href="https://app.box.com/">signup</a> and <a href="https://app.box.com/developers/services">create a BoxView app</a> before you start. The app will have an API key that you will need in all requests you make with Box. I am implementing it in Rails, but you could do this on any backend in exactly the same fashion.</p>

<h3>Upload a Document</h3>

<p>The first step to making a viewable document is uploading the file to box. I decided to use the net::http library when communicating with the BoxViewAPI. However, you can use any RESTful lib. RestClient is another popular one. Then make a post with the necessary headers. The response if successful will contain a document id.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="c1"># Headers used throughout these examples</span>
</span><span class='line'>  <span class="c1"># Get YOUR_API_KEY from the box view application page</span>
</span><span class='line'>  <span class="no">BOX_HEADERS</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>    <span class="s1">&#39;Authorization&#39;</span> <span class="o">=&gt;</span> <span class="s2">&quot;Token </span><span class="si">#{</span><span class="no">YOUR_API_KEY</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="s1">&#39;Content-type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;application/json&#39;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">upload_document</span>
</span><span class='line'>    <span class="n">document_uri</span> <span class="o">=</span> <span class="no">URI</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s2">&quot;https://view-api.box.com/1/documents&quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>      <span class="s1">&#39;url&#39;</span> <span class="o">=&gt;</span> <span class="n">original_url</span>
</span><span class='line'>      <span class="c1"># If thumbnails are desired:</span>
</span><span class='line'>      <span class="c1">#, &#39;thumbnails&#39; =&gt; &#39;100x100&#39;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="n">http</span> <span class="o">=</span> <span class="ss">Net</span><span class="p">:</span><span class="ss">:HTTP</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">document_uri</span><span class="o">.</span><span class="n">host</span><span class="p">,</span> <span class="n">document_uri</span><span class="o">.</span><span class="n">port</span><span class="p">)</span>
</span><span class='line'>    <span class="n">http</span><span class="o">.</span><span class="n">use_ssl</span> <span class="o">=</span> <span class="kp">true</span>
</span><span class='line'>    <span class="n">request</span> <span class="o">=</span> <span class="ss">Net</span><span class="p">:</span><span class="ss">:HTTP</span><span class="o">::</span><span class="no">Post</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">document_uri</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="no">BOX_HEADERS</span><span class="p">)</span>
</span><span class='line'>    <span class="n">request</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">to_json</span>
</span><span class='line'>    <span class="n">response</span> <span class="o">=</span> <span class="n">http</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
</span><span class='line'>    <span class="n">parsed</span> <span class="o">=</span> <span class="no">JSON</span><span class="o">.</span><span class="n">parse</span> <span class="n">response</span><span class="o">.</span><span class="n">body</span>
</span><span class='line'>    <span class="n">document_id</span> <span class="o">=</span> <span class="n">parsed</span><span class="o">[</span><span class="s2">&quot;id&quot;</span><span class="o">]</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">document_id</span>
</span><span class='line'>    <span class="c1"># or self.update_attribute :document_id, document_id</span>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Create a Session</h3>

<p>Now that you have a document id, you can make upload_document return the id or just save it to a model (This is useful if you&rsquo;re interested in implementing WebHooks). Next you can use that document id to create a session which will begin the conversion of the document, and let you know when it is ready. If you are using this in your web app frequently, I recommend using <a href="http://sidekiq.org/">Sidekiq</a> to offload all these network calls and possible database saves to an asynchronous process. When successful, box will return a 201, which means the document is ready for viewing. If you don&rsquo;t get a 201 you will get a 202 or 400 response code. A 202 means the document is not yet ready for viewing. A 400 means the conversion has failed. If you&rsquo;d like to view your file at this point, just head over to <a href="https://view-api.box.com/1/sessions/{session%20id}/view?theme=light">https://view-api.box.com/1/sessions/{session id}/view?theme=light</a>, where session id is the id you get from the 201 response.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="k">def</span> <span class="nf">create_session</span><span class="p">(</span><span class="n">document_id</span><span class="p">)</span>
</span><span class='line'>    <span class="n">session_uri</span> <span class="o">=</span> <span class="no">URI</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s2">&quot;https://view-api.box.com/1/sessions&quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>      <span class="s2">&quot;document_id&quot;</span> <span class="o">=&gt;</span> <span class="n">document_id</span>
</span><span class='line'>      <span class="c1">#, &quot;expires_at&quot; =&gt; Time.now + 1.hour</span>
</span><span class='line'>      <span class="c1"># You could specify an expiration date.</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="n">http</span> <span class="o">=</span> <span class="ss">Net</span><span class="p">:</span><span class="ss">:HTTP</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">session_uri</span><span class="o">.</span><span class="n">host</span><span class="p">,</span> <span class="n">session_uri</span><span class="o">.</span><span class="n">port</span><span class="p">)</span>
</span><span class='line'>    <span class="n">http</span><span class="o">.</span><span class="n">use_ssl</span> <span class="o">=</span> <span class="kp">true</span>
</span><span class='line'>    <span class="n">request</span> <span class="o">=</span> <span class="ss">Net</span><span class="p">:</span><span class="ss">:HTTP</span><span class="o">::</span><span class="no">Post</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">session_uri</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="no">BOX_HEADERS</span><span class="p">)</span>
</span><span class='line'>    <span class="n">request</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">to_json</span>
</span><span class='line'>    <span class="n">response</span> <span class="o">=</span> <span class="n">http</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
</span><span class='line'>    <span class="k">case</span> <span class="n">response</span><span class="o">.</span><span class="n">code</span>
</span><span class='line'>    <span class="k">when</span> <span class="s2">&quot;201&quot;</span> <span class="c1"># Done converting</span>
</span><span class='line'>      <span class="n">parsed</span> <span class="o">=</span> <span class="no">JSON</span><span class="o">.</span><span class="n">parse</span> <span class="n">response</span><span class="o">.</span><span class="n">body</span>
</span><span class='line'>      <span class="n">session_id</span> <span class="o">=</span> <span class="n">parsed</span><span class="o">[</span><span class="s2">&quot;id&quot;</span><span class="o">]</span>
</span><span class='line'>      <span class="k">return</span> <span class="n">session_id</span>
</span><span class='line'>      <span class="c1"># or self.update_attribute :session_id, session_id</span>
</span><span class='line'>    <span class="k">when</span> <span class="s2">&quot;202&quot;</span> <span class="c1"># Session not ready yet</span>
</span><span class='line'>      <span class="n">time</span> <span class="o">=</span> <span class="n">response</span><span class="o">[</span><span class="s1">&#39;Retry-After&#39;</span><span class="o">].</span><span class="n">to_i</span>
</span><span class='line'>      <span class="c1"># here you would retry based on the time variable</span>
</span><span class='line'>      <span class="c1"># You could use sidekiqs perform_in method, or just sleep</span>
</span><span class='line'>    <span class="k">when</span> <span class="s2">&quot;400&quot;</span> <span class="c1"># An error occurred while converting the document or the document does not exist</span>
</span><span class='line'>      <span class="no">Rails</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span> <span class="s2">&quot;Document failed to convert - </span><span class="si">#{</span><span class="n">response</span><span class="o">.</span><span class="n">body</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'>    <span class="k">else</span>
</span><span class='line'>      <span class="k">raise</span> <span class="s2">&quot;BoxSessionError </span><span class="si">#{</span><span class="n">response</span><span class="o">.</span><span class="n">inspect</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Generate a Thumbnail</h3>

<p>A cool feature BoxView has is thumbnail generation. It can return a thumbnail of any size 16-1024 wide by 16-768 high. This way you can see a preview of the document before displaying it to a user. The BoxView API only requires a height and width, and the document that you want the thumbnail generated from.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="k">def</span> <span class="nf">generate_thumbnail</span><span class="p">(</span><span class="n">document_id</span><span class="p">)</span>
</span><span class='line'>    <span class="n">query_params</span> <span class="o">=</span> <span class="s2">&quot;?width=100&amp;height=100&quot;</span>
</span><span class='line'>    <span class="n">thumbnail_uri</span> <span class="o">=</span> <span class="no">URI</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s2">&quot;https://view-api.box.com/1/documents/</span><span class="si">#{</span><span class="n">document_id</span><span class="si">}</span><span class="s2">/thumbnail&quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="n">http</span> <span class="o">=</span> <span class="ss">Net</span><span class="p">:</span><span class="ss">:HTTP</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">thumbnail_uri</span><span class="o">.</span><span class="n">host</span><span class="p">,</span> <span class="n">thumbnail_uri</span><span class="o">.</span><span class="n">port</span><span class="p">)</span>
</span><span class='line'>    <span class="n">http</span><span class="o">.</span><span class="n">use_ssl</span> <span class="o">=</span> <span class="kp">true</span>
</span><span class='line'>    <span class="n">thumbnail_path</span> <span class="o">=</span> <span class="n">thumbnail_uri</span><span class="o">.</span><span class="n">path</span> <span class="o">+</span> <span class="n">params</span>
</span><span class='line'>    <span class="n">request</span> <span class="o">=</span> <span class="ss">Net</span><span class="p">:</span><span class="ss">:HTTP</span><span class="o">::</span><span class="no">Get</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">thumbnail_path</span><span class="p">,</span> <span class="no">BOX_HEADERS</span><span class="p">)</span>
</span><span class='line'>    <span class="n">response</span> <span class="o">=</span> <span class="n">http</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
</span><span class='line'>    <span class="k">case</span> <span class="n">response</span><span class="o">.</span><span class="n">code</span>
</span><span class='line'>    <span class="k">when</span> <span class="s2">&quot;200&quot;</span> <span class="c1"># Valid thumbnail</span>
</span><span class='line'>      <span class="n">thumbnail</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">body</span>
</span><span class='line'>      <span class="c1"># Now upload the thumbnail to another server</span>
</span><span class='line'>      <span class="c1"># or use it however you would like</span>
</span><span class='line'>    <span class="k">when</span> <span class="s2">&quot;202&quot;</span> <span class="c1"># Thumbnail isn&#39;t ready yet</span>
</span><span class='line'>      <span class="n">time</span> <span class="o">=</span> <span class="n">response</span><span class="o">[</span><span class="s1">&#39;Retry-After&#39;</span><span class="o">].</span><span class="n">to_i</span>
</span><span class='line'>      <span class="c1"># Same as a session 202, sleep or worker</span>
</span><span class='line'>    <span class="k">when</span> <span class="s2">&quot;400&quot;</span> <span class="c1"># Width/Height are invalid</span>
</span><span class='line'>      <span class="no">Rails</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span> <span class="s2">&quot;400 Box Thumbnail Width x Height Invalid - </span><span class="si">#{</span><span class="n">response</span><span class="o">.</span><span class="n">body</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'>    <span class="k">else</span>
</span><span class='line'>      <span class="k">raise</span> <span class="s2">&quot;BoxThumbnailError </span><span class="si">#{</span><span class="n">response</span><span class="o">.</span><span class="n">inspect</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Box offers a chance of producing the thumbnail earlier in the process. If you state the width and height earlier when uploading the document, box will have the thumbnail ready by the time you call generate_thumbnail. After getting the thumbnail from the response you could upload it to your own server.</p>

<h3>onFinish</h3>

<p>My examples above are all in ruby, but their also exists a <a href="https://view-upload.herokuapp.com/">great python project on GitHub</a> that shows how to do the same. If you needed help getting started with BoxView I hope you no longer do. If you require WebHooks with BoxView, they aren&rsquo;t very difficult. Just email <a href="&#x6d;&#x61;&#105;&#108;&#116;&#111;&#x3a;&#97;&#112;&#x69;&#x40;&#98;&#x6f;&#120;&#46;&#x63;&#x6f;&#109;">&#97;&#112;&#x69;&#64;&#x62;&#111;&#120;&#x2e;&#99;&#x6f;&#109;</a> with your API key and domain to send the responses to a controller. If you want to test that WebHooks work in your testing environment, I recommend using <a href="https://ngrok.com">ngrok</a>. It helped me confirm everything was in a good working condition before using it in other environments. As always, if you need help let me know.</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/2/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2014/05/26/sinatra-assets/">Sinatra Assets</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/05/18/boxview/">BoxView</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/05/11/fragment-factories/">Fragment Factories</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/05/05/promises-and-more/">Promises and More</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/04/28/html5-video-and-audio/">HTML5 Video and Audio</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/vinnymac">@vinnymac</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'vinnymac',
            count: 5,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - Vincent Taverna -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'devcontinuum';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
